import{r as d,m as be,j as t,L as ge,a as _,S as T}from"./app-CxQIk-Ug.js";import{S as _e,F as H}from"./AdminLayout-Ch0RJaaH.js";import{B as j}from"./button-eWlrO1vI.js";import ye from"./BreadcrumbsHeader-ztKk4f-G.js";import{D as A}from"./DropdownInputField-CATmAO2Q.js";import{I as O}from"./InputField-ClYvY_TS.js";import{I as b}from"./InputError-B_I55Pol.js";import{B as je,C as ve,i as we}from"./constants-DEVjsWMH.js";import{u as Ne}from"./useAppUrl-CjqOY4Q6.js";import{t as x,T as Ce}from"./index-BxD4ZtM3.js";import Se from"./DynamicTableControls-BBZXxs2q.js";import{I as ke}from"./input-C3invO0g.js";import{F as Ie}from"./FillterToggle-DxBAgWQx.js";import Re from"./DynamicTable-CqqNB_Qd.js";import Ee from"./ActionMenu-BbqZ2nO_.js";import Te from"./SidebarModal-BwBQKpMA.js";import{E as Ae}from"./ExportButton-CE8gFddm.js";import{S as Oe}from"./search-CXT4UFH7.js";import{S as Le}from"./square-plus-CzykMMLL.js";import{R as Ue}from"./rotate-ccw-DgX9TvGC.js";import{c as L}from"./createLucideIcon-DUzL0oSb.js";import{T as Fe}from"./trash-2-BAENtbzN.js";import"./sidebar-CmbCP2Gp.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-a0Ptbf1R.js";import"./index-D20yT8t5.js";import"./floating-ui.react-dom-CDryE2et.js";import"./x-CoOb-UyO.js";import"./skeleton-DNA1kKC7.js";import"./tooltip-DJWjtVs0.js";import"./nav-user-CUeqll6F.js";import"./avatar-CT_f4ETp.js";import"./dropdown-menu-BIG2J05K.js";import"./check-BlEJph0r.js";import"./chevron-right-9pm6d_Wd.js";import"./users-round-Dhttk4ok.js";import"./heart-pulse-DEWB0aq-.js";import"./chevron-up-DDsNXP0q.js";import"./breadcrumb-ZXvPNnk5.js";import"./ellipsis-lwZyIBcE.js";import"./file-output-DqEtO73h.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],De=L("circle-check-big",$e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Me=L("circle-x",Pe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],qe=L("printer",Be);function Ut({documents:U,residents:v,certificates:K,queryParams:m=null,success:w=null,error:g=null}){var Q;const W=[{label:"Residents Information",showOnMobile:!1},{label:"Certificate Issuance",showOnMobile:!0}],G=Ne(),[Y,N]=d.useState(!1),C=["fullname","fullname_2","day","month","year","ctrl_no","civil_status","civil_status_2","purpose","purpose_2","purok","day_2","month_2","year_2","issued_on"],F=e=>e.toLowerCase().replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()),{data:r,setData:l,errors:h,setError:$,reset:D,clearErrors:Z}=be({resident_id:null,resident_name:"",document_id:null,document_name:"",birthdate:null,age:null,civil_status:"",resident_image:"",purpose:"",placeholders:null,resident_id_2:null,resident_name_2:"",civil_status_2:"",resident_image_2:"",purpose_2:""}),ee=[{label:"January",value:"1"},{label:"February",value:"2"},{label:"March",value:"3"},{label:"April",value:"4"},{label:"May",value:"5"},{label:"June",value:"6"},{label:"July",value:"7"},{label:"August",value:"8"},{label:"September",value:"9"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}],te=async e=>{const s=U.find(a=>a.id==e);if(s){l("document_name",s.name),l("document_id",s.id);try{const a=await _.get(`${G}/document/fetchplaceholders/${e}`);l("placeholders",a.data.placeholders)}catch(a){console.error("Error fetching placeholders:",a)}}},se=e=>{const s=Number(e.target.value),a=v.find(n=>n.id==s);a&&(l("resident_id",a.id),l("resident_name",`${a.firstname} ${a.middlename} ${a.lastname} ${a.suffix??""}`),l("gender",a.gender),l("birthdate",a.birthdate),l("civil_status",a.civil_status),l("resident_image",a.resident_picture_path))},ae=e=>{const s=Number(e.target.value),a=v.find(n=>n.id==s);a&&(l("resident_id_2",a.id),l("resident_name_2",`${a.firstname} ${a.middlename} ${a.lastname} ${a.suffix??""}`),l("civil_status_2",a.civil_status),l("resident_image_2",a.resident_picture_path))},P=v.map(e=>({label:`${e.firstname} ${e.middlename??""} ${e.lastname}${e.suffix?", "+e.suffix:""}`.replace(/\s+/g," ").trim(),value:e.id})),M=U.map(e=>({label:e.name.replace(/\s+/g," ").trim(),value:e.id.toString()})),S=(r.placeholders||[]).some(e=>e.endsWith("_2")),ie=async()=>{var a,n;$({}),N(!0);const e={};if(r.resident_id||(e.resident_id="Please select a resident."),r.document_id||(e.document_id="Please select a certificate."),(!r.purpose||r.purpose.trim()==="")&&(e.purpose="Purpose is required."),(r.placeholders||[]).filter(i=>!C.includes(i)).forEach(i=>{(!r[i]||r[i].trim()==="")&&(e[i]=`${i.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase())} is required.`)}),Object.keys(e).length>0){$(e),x.error("Validation failed",{description:"Please fill in all required fields.",duration:4e3,className:"bg-red-100 text-red-800"}),N(!1);return}const s={document_id:r.document_id,resident_id:r.resident_id,purpose:r.purpose,...S?{resident_id_2:r.resident_id_2,purpose_2:r.purpose_2}:{},...Object.fromEntries((r.placeholders||[]).filter(i=>!C.includes(i)).map(i=>[i,r[i]||""]))};try{x.loading("Issuing document...",{duration:5e3,className:"bg-blue-100 text-blue-800"});const i=await _.post(route("certificate.store"),s,{responseType:"blob",withCredentials:!0}),c=new Blob([i.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),o=window.URL.createObjectURL(c),u=document.createElement("a");u.href=o;const f=i.headers["content-disposition"],p=f==null?void 0:f.match(/filename="?([^"]+)"?/),he=p?p[1]:"certificate.docx";u.setAttribute("download",he),document.body.appendChild(u),u.click(),u.remove(),T.get(route("certificate.index",{success:!0}))}catch(i){console.error("Issuance failed",i);const c=((n=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:n.message)||"Unknown error occurred.";x.error("Failed to issue document",{description:c,duration:5e3,className:"bg-red-100 text-red-800"})}},re=async e=>{var s,a;try{x.loading("Issuing document...");const n=await _.post(route("certificate.issue",e),{},{responseType:"blob"}),i=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),c=window.URL.createObjectURL(i),o=document.createElement("a");o.href=c;const u=n.headers["content-disposition"],f=u==null?void 0:u.match(/filename="?([^"]+)"?/),p=f?f[1]:"certificate.docx";o.setAttribute("download",p),document.body.appendChild(o),o.click(),o.remove(),T.get(route("certificate.index",{success:!0}))}catch(n){console.error("Issuance failed",n),x.error("Failed to issue certificate",{description:((a=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:a.message)||"Unknown error occurred."})}};m=m||{};const[B,ne]=d.useState(m.name??""),le=e=>{e.preventDefault(),k("name",B)},k=(e,s)=>{s&&s.trim()!==""?m[e]=s:delete m[e],m.page&&delete m.page,T.get(route("certificate.index",m))},oe=(e,s)=>{if(s.key==="Enter")k(e,s.target.value);else return},[ce,q]=d.useState(!1),[z,J]=d.useState(""),I=Object.entries(m||{}).some(([e,s])=>["certificate_type","request_status","issued_by","issued_at"].includes(e)&&s&&s!=="");d.useEffect(()=>{I&&X(!0)},[I]);const R=[{key:"id",label:"Issued ID"},{key:"name",label:"Name"},{key:"certificate",label:"Certificate"},{key:"purpose",label:"Purpose"},{key:"request_status",label:"Request Status"},{key:"issued_by",label:"Issued By"},{key:"issued_at",label:"Issued At"},{key:"control_number",label:"Control Number"},{key:"actions",label:"Actions"}],[V,X]=d.useState(I),[ze,Je]=d.useState(!0),[Ve,Xe]=d.useState(!1),de=R.map(e=>e.key),[y,me]=d.useState(()=>{const e=localStorage.getItem("certificate_visible_columns");return e?JSON.parse(e):de});d.useEffect(()=>{localStorage.setItem("certificate_visible_columns",JSON.stringify(y))},[y]);const ue={id:e=>t.jsx("span",{className:"text-xs text-gray-700",children:e.id}),name:e=>{const s=e.resident??{},a=`${s.firstname??""} ${s.middlename??""} ${s.lastname??""} ${s.suffix??""}`.trim();return t.jsx("span",{className:"text-sm font-medium text-gray-800",children:a||"—"})},certificate:e=>{var s;return t.jsx("span",{className:"text-xs text-indigo-700 font-medium",children:((s=e.document)==null?void 0:s.name)??"—"})},purpose:e=>t.jsx("span",{className:"text-xs text-gray-700",children:e.purpose??"—"}),request_status:e=>t.jsx("span",{className:`text-xs font-medium ${we[e.request_status]}`,children:ve[e.request_status]??"—"}),issued_by:e=>{var s;return t.jsx("span",{className:"text-xs text-gray-700",children:je[(s=e.issued_by)==null?void 0:s.position]??"—"})},issued_at:e=>t.jsx("span",{className:"text-xs text-gray-600",children:e.issued_at??"—"}),control_number:e=>t.jsx("span",{className:"text-xs text-gray-600",children:e.control_number??"—"}),actions:e=>t.jsx(Ee,{actions:[...e.request_status==="pending"?[{label:"Issue",icon:t.jsx(De,{className:"w-4 h-4 text-blue-600"}),onClick:()=>re(e.id)},{label:"Deny",icon:t.jsx(Me,{className:"w-4 h-4 text-orange-600"}),onClick:()=>handleCertificateDeny(e.id)}]:[],{label:"Delete",icon:t.jsx(Fe,{className:"w-4 h-4 text-red-600"}),onClick:()=>handleDelete(e.id)},{label:"Download",icon:t.jsx(H,{className:"w-4 h-4 text-green-600"}),onClick:()=>fe(e.id)},{label:"Print",icon:t.jsx(qe,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>xe(e.id)}]})},pe=()=>{J("add"),q(!0)},xe=async e=>{var s,a;try{const n=await _.get(route("certificate.print",e),{responseType:"blob"}),i=new Blob([n.data],{type:"application/pdf"}),c=window.URL.createObjectURL(i),o=window.open(c);o&&(o.onload=()=>{o.focus(),o.print()}),setTimeout(()=>{window.URL.revokeObjectURL(c)},2e3)}catch(n){const i=((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to load PDF.";x.error(i,{description:"Operation failed!",duration:3e3,className:"bg-red-100 text-red-800"})}},fe=async e=>{var s,a;try{const n=await _.get(route("certificate.download",e),{responseType:"blob"}),i=n.headers["content-disposition"],c=i==null?void 0:i.match(/filename="?([^"]+)"?/),o=c?c[1]:`certificate_${e}.docx`,u=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),f=window.URL.createObjectURL(u),p=document.createElement("a");p.href=f,p.setAttribute("download",o),document.body.appendChild(p),p.click(),p.remove(),setTimeout(()=>window.URL.revokeObjectURL(f),1e3),x.success("Certificate downloaded successfully.",{description:"Operation successful!",duration:3e3,className:"bg-green-100 text-green-800"})}catch(n){const i=((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.error)||"Download failed.";x.error(i,{description:"Operation failed!",duration:3e3,className:"bg-red-100 text-red-800"})}},E=()=>{q(!1),J(""),D(),Z(),N(!1)};return d.useEffect(()=>{if(w){E(),x.success(w,{description:"Operation successful!",duration:3e3,className:"bg-green-100 text-green-800"});const e=new URL(window.location.href);e.searchParams.delete("success"),window.history.replaceState({},"",e.pathname+e.search)}},[w]),d.useEffect(()=>{if(!g)return;E();const e=typeof g=="string"?g:g.message||"An error occurred.";x.error(e,{description:"Operation failed!",duration:3e3,className:"bg-red-100 text-red-800"}),typeof clearError=="function"&&clearError()},[g]),t.jsxs(_e,{children:[t.jsx(ge,{title:"Certificate Issuance"}),t.jsxs("div",{children:[t.jsx(ye,{breadcrumbs:W}),t.jsx(Ce,{richColors:!0}),t.jsxs("div",{className:"p-2 md:p-4",children:[t.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:t.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-xl shadow-sm",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:t.jsx(H,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Certificate Issuance"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Manage the"," ",t.jsxs("span",{className:"font-medium",children:["issuance of certificates"," "]}),"for residents. Use the tools below to search, filter, export, or issue new certificates as needed."]})]})]})}),t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[t.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[t.jsx(Se,{allColumns:R,visibleColumns:y,setVisibleColumns:me,showFilters:V,toggleShowFilters:()=>X(e=>!e)}),t.jsx(Ae,{url:"/certificate/export-certificates-excel",queryParams:m,label:"Export Certificates as XLSX"})]}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[t.jsxs("form",{onSubmit:le,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[t.jsx(ke,{type:"text",placeholder:"Search Name",value:B,onChange:e=>ne(e.target.value),onKeyDown:e=>oe("name",e),className:"w-full"}),t.jsxs("div",{className:"relative group z-50",children:[t.jsx(j,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:t.jsx(Oe,{})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]})]}),t.jsxs("div",{className:"relative group z-50",children:[t.jsx(j,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:pe,children:t.jsx(Le,{className:"w-4 h-4"})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Issue Certificate"})]})]})]}),V&&t.jsx(Ie,{queryParams:m,searchFieldName:k,visibleFilters:["certificate_type","request_status","issued_by","issued_at"],certificateTypes:M,showFilters:!0,months:ee,clearRouteName:"certificate.index",clearRouteParams:{}}),t.jsx(Re,{passedData:K,allColumns:R,columnRenderers:ue,visibleColumns:y,showTotal:!0})]})}),t.jsx(Te,{isOpen:ce,onClose:()=>{E()},title:z==="add"?"Issue a Certificate":"View Resident Details",children:z==="add"&&t.jsxs("div",{className:"bg-white shadow-xl rounded-2xl p-8 my-10 space-y-10 border border-gray-100",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Certificate & Resident Selection"}),t.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Choose the type of certificate to issue and select the resident(s) for whom it will be generated."}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx(A,{label:"Select a Certificate",items:M,value:r.document_name||"",onChange:e=>te(e.target.value)}),t.jsx(b,{message:h.document_id,className:"mt-1"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Example: Certificate of Indigency, Residency, etc."})]}),t.jsxs("div",{children:[t.jsx(A,{label:"Select a Resident",items:P,value:r.resident_name||"",onChange:se}),t.jsx(b,{message:h.resident_id,className:"mt-1"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"The resident for whom this certificate will be issued."})]}),S&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx(A,{label:"Select Second Resident",items:P,value:r.resident_name_2||"",onChange:ae}),t.jsx(b,{message:h.resident_id_2,className:"mt-1"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Some certificates require two residents (e.g., joint certification)."})]})]})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Purpose"}),t.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Provide the purpose of the certificate. This will appear in the certification document."}),t.jsxs("div",{className:"space-y-5",children:[t.jsxs("div",{children:[t.jsx(O,{label:"Purpose",value:r.purpose||"",onChange:e=>l("purpose",e.target.value)}),t.jsx(b,{message:h.purpose,className:"mt-1"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Example: Scholarship requirement, job application, financial assistance."})]}),S&&t.jsxs("div",{children:[t.jsx(O,{label:"Purpose (Second Resident)",value:r.purpose_2||"",onChange:e=>l("purpose_2",e.target.value)}),t.jsx(b,{message:h.purpose_2,className:"mt-1"}),t.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Provide a separate purpose if the second resident requires one."})]})]})]}),((Q=r.placeholders)==null?void 0:Q.length)>0&&t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Additional Information"}),t.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Some templates require extra details. Fill out the fields below if they are present in the template."}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.placeholders.filter(e=>!C.includes(e)).map((e,s)=>t.jsxs("div",{children:[t.jsx(O,{label:F(e),value:r[e]||"",onChange:a=>l(e,a.target.value)}),t.jsx(b,{message:h[e],className:"mt-1"}),t.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Provide information for"," ",t.jsx("span",{className:"font-medium",children:F(e)}),"."]})]},s))})]}),t.jsxs("div",{className:"flex justify-between items-center border-t pt-6",children:[t.jsxs(j,{type:"button",onClick:()=>D(),variant:"outline",className:"flex items-center gap-2 text-gray-500",children:[t.jsx(Ue,{className:"w-4 h-4"})," Reset"]}),t.jsx(j,{onClick:ie,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl shadow-md",disabled:Y,children:"Issue Certificate"})]})]})})]})]})]})}export{Ut as default};
