import{K as ge,r as n,m as he,j as e,L as be,S as B,a as V}from"./app-DWLvIQdF.js";import{S as fe}from"./AdminLayout-DF3T9r93.js";import{B as v}from"./button-D5oOHpih.js";import{I as ye}from"./input-Bjq-UOVg.js";import je from"./BreadcrumbsHeader-Cn59CTpR.js";import{t as m,T as ve}from"./index-DiQ2ABd4.js";import _e from"./DynamicTable-D6nhkc6_.js";import Ne from"./ActionMenu-BTp0V9kb.js";import{R as Se,O as we,Q as H}from"./constants-BC8DDBPg.js";import De from"./SidebarModal-vxJbyoHl.js";import ke from"./DynamicTableControls-Zyjm1i4x.js";import{F as Ee}from"./FillterToggle-C8sWYfDm.js";import{u as Ce}from"./useAppUrl-DygNqr49.js";import Re from"./PersonDetailContent-Da4-28D9.js";import Ie from"./DeleteConfirmationModal-BeH75Yd3.js";import{I as Te}from"./InputLabel-CbfaVs9z.js";import{D as Ae}from"./DropdownInputField-CGF8rdIi.js";import{I as h}from"./InputField-DCBd0Ia9.js";import{u as Oe}from"./handleResidentChange-MSXQXwLa.js";import{I as b}from"./InputError-B2rpTTc2.js";import{S as Me}from"./SelectField-DXLqNboK.js";import{T as Fe}from"./textarea-DbOMRDJQ.js";import{I as Pe,a as $e,b as Le}from"./index-BK-nQiHO.js";import{H as Ue}from"./heart-pulse-DBmhNY90.js";import{S as Be}from"./search-G9nvaKgi.js";import{L as Ve}from"./list-plus-D54S5Rjd.js";import{R as He}from"./rotate-ccw-D5bcHjGp.js";import{E as ze}from"./eye-dW3Ce4Eu.js";import{S as Ye}from"./square-pen-Cxeeoy9N.js";import{T as Ge}from"./trash-2-DlJ2Uvw3.js";import"./sidebar-B55M1Lhe.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-C7xi9LN0.js";import"./index-DaxHkuH7.js";import"./floating-ui.react-dom-TXoiB1Cy.js";import"./x-Dj4h3Hl7.js";import"./createLucideIcon-COg8xDid.js";import"./skeleton-DxhMNfTQ.js";import"./tooltip-DGgHmMGp.js";import"./nav-user-ifqrtdkH.js";import"./avatar-xvo1q8ho.js";import"./dropdown-menu-301tgmQC.js";import"./check-DAMLPx8H.js";import"./chevron-right-B7veGfa5.js";import"./users-round-DfUg6NaG.js";import"./chevron-up-DDEZVR48.js";import"./breadcrumb-Tr7bH4sQ.js";import"./ellipsis-BLBb_BVq.js";import"./iconBase-BwLSqiDZ.js";import"./index-BHp23fmt.js";import"./index-CidfdT4c.js";function Yt({pregnancy_records:z,puroks:Y,queryParams:l,residents:C}){const G=[{label:"Medical Information",showOnMobile:!1},{label:"Vaccinations",showOnMobile:!0}];l=l||{};const R=Ce(),d=ge().props,_=(d==null?void 0:d.success)??null,N=(d==null?void 0:d.error)??null,[K,S]=n.useState(!1),[I,Q]=n.useState(null),[f,y]=n.useState(null),[u,T]=n.useState(null),[A,X]=n.useState(l.name??""),[J,p]=n.useState(!1),[W,O]=n.useState(null),Z=t=>{if(!t)return"Unknown";const s=new Date(t),r=new Date;let c=r.getFullYear()-s.getFullYear();const i=r.getMonth()-s.getMonth();return(i<0||i===0&&r.getDate()<s.getDate())&&c--,c},q=t=>{t.preventDefault(),w("name",A)},w=(t,s)=>{s&&s.trim()!==""?l[t]=s:delete l[t],l.page&&delete l.page,B.get(route("pregnancy.index",l))},ee=(t,s)=>{if(s.key==="Enter")w(t,s.target.value);else return},D=[{key:"id",label:"ID"},{key:"name",label:"Resident Name"},{key:"age",label:"Age"},{key:"status",label:"Pregnancy Status"},{key:"expected_due_date",label:"Expected Due"},{key:"delivery_date",label:"Delivery Date"},{key:"notes",label:"Notes"},{key:"purok_number",label:"Purok Number"},{key:"actions",label:"Actions"}],[M,te]=n.useState(D.map(t=>t.key)),k=Object.entries(l||{}).some(([t,s])=>["purok","sex","age_group","pregnancy_status","expected_due_date","delivery_date"].includes(t)&&s&&s!=="");n.useEffect(()=>{k&&P(!0)},[k]);const[F,P]=n.useState(k),se={id:t=>t.id,name:t=>{const s=t.resident??{};return e.jsxs("span",{children:[s.firstname," ",s.middlename??""," ",s.lastname," ",s.suffix??""]})},age:t=>{var r;const s=Z((r=t.resident)==null?void 0:r.birthdate);return typeof s!="number"?"Unknown":e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:s}),s>60&&e.jsx("span",{className:"text-xs text-rose-500 font-semibold",children:"Senior Citizen"})]})},status:t=>{const s=t.status??"default";return e.jsx("span",{className:H[s]||H.default,children:we[s]||"Unknown"})},expected_due_date:t=>t.expected_due_date?new Date(t.expected_due_date).toLocaleDateString():"—",delivery_date:t=>t.delivery_date?new Date(t.delivery_date).toLocaleDateString():"—",notes:t=>t.notes??"—",purok_number:t=>{var s;return((s=t.resident)==null?void 0:s.purok_number)??"—"},actions:t=>e.jsx(Ne,{actions:[{label:"View",icon:e.jsx(ze,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>{var s;return xe((s=t.resident)==null?void 0:s.id)}},{label:"Edit",icon:e.jsx(Ye,{className:"w-4 h-4 text-green-500"}),onClick:()=>{ce(t.id)}},{label:"Delete",icon:e.jsx(Ge,{className:"w-4 h-4 text-red-600"}),onClick:()=>ue(t.id)}]})},re=()=>{y("add"),p(!0)},{data:o,setData:x,post:$,errors:g,reset:L,clearErrors:ae}=he({resident_id:null,resident_name:"",resident_image:null,birthdate:null,civil_status:"",purok_number:null,pregnancy_records:[[]],_method:void 0,record_id:null}),ne=Oe(C,x),le=C.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),oe=()=>{x("pregnancy_records",[...o.pregnancy_records||[],{}])},ie=t=>{const s=[...o.pregnancy_records||[]];s.splice(t,1),x("pregnancy_records",s),m.warning("Record removed.",{duration:2e3})},j=(t,s,r)=>{x(c=>{const i=[...c.pregnancy_records];return i[s]||(i[s]={}),i[s]={...i[s],[r]:t},{...c,pregnancy_records:i}})},de=t=>{t.preventDefault(),$(route("pregnancy.store"),{onError:s=>{console.error("Validation Errors:",s);const r=Object.values(s).join("<br />");m.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:r}}),duration:3e3,closeButton:!0})},onSuccess:()=>{E()}})},ce=async t=>{var s,r,c,i;y("edit");try{const a=(await V.get(`${R}/pregnancy/details/${t}`)).data.record;T(a),x({resident_id:a.resident_id||null,resident_name:a.resident?`${a.resident.firstname} ${a.resident.middlename??""} ${a.resident.lastname} ${a.resident.suffix??""}`.trim():"",resident_image:((s=a.resident)==null?void 0:s.resident_picture_path)||null,birthdate:((r=a.resident)==null?void 0:r.birthdate)||null,sex:((c=a.resident)==null?void 0:c.sex)||"",purok_number:((i=a.resident)==null?void 0:i.purok_number)||null,pregnancy_records:[{status:a.status||"",expected_due_date:a.expected_due_date||"",delivery_date:a.delivery_date||"",notes:a.notes||""}],_method:"PUT",record_id:a.id}),p(!0)}catch(U){console.error("Error fetching pregnancy record details:",U)}},me=t=>{t.preventDefault(),$(route("pregnancy.update",o.record_id),{onError:s=>{const r=Object.values(s).join("<br />");m.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:r}}),duration:3e3,closeButton:!0})},onSuccess:()=>{E()}})},ue=t=>{Q(t),S(!0)},pe=()=>{B.delete(route("pregnancy.destroy",I),{onError:t=>{console.error("Validation Errors:",t);const s=Object.values(t).join("<br />");m.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})}}),S(!1)},xe=async t=>{try{const s=await V.get(`${R}/resident/showresident/${t}`);O(s.data.resident)}catch(s){console.error("Error fetching placeholders:",s)}p(!0),y("view")},E=()=>{p(!1),O(null),T(null),y(null),L(),ae()};return n.useEffect(()=>{_&&(E(),m.success(_,{description:"Operation successful!",duration:3e3,closeButton:!0})),d.success=null},[_]),n.useEffect(()=>{N&&m.error(N,{description:"Operation failed!",duration:3e3,closeButton:!0}),d.error=null},[N]),e.jsxs(fe,{children:[e.jsx(be,{title:"Medical Information"}),e.jsxs("div",{children:[e.jsx(ve,{richColors:!0}),e.jsx(je,{breadcrumbs:G}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-pink-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-pink-100 rounded-full",children:e.jsx(Ue,{className:"w-6 h-6 text-pink-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Pregnancy Records"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Manage and track residents’ ",e.jsx("span",{className:"font-medium",children:"pregnancy records"}),". Use the tools below to search, filter, or export data for better maternal care monitoring."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(ke,{allColumns:D,visibleColumns:M,setVisibleColumns:te,showFilters:F,toggleShowFilters:()=>P(t=>!t)})}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:q,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(ye,{type:"text",placeholder:"Search Resident Name",value:A,onChange:t=>X(t.target.value),onKeyDown:t=>ee("name",t.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(v,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Be,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(v,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",type:"button",onClick:re,children:e.jsx(Ve,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Pregnancy Records"})]})]})})]}),F&&e.jsx(Ee,{queryParams:l,searchFieldName:w,visibleFilters:["purok","sex","age_group","pregnancy_status","expected_due_date","delivery_date"],puroks:Y,showFilters:!0,clearRouteName:"pregnancy.index",clearRouteParams:{}}),e.jsx(_e,{passedData:z,allColumns:D,columnRenderers:se,queryParams:l,visibleColumns:M,showTotal:!0})]})})}),e.jsxs(De,{isOpen:J,onClose:()=>p(!1),title:f=="view"?"Resident Details":f=="add"?"Add Pregnancy Records":"Edit Pregnancy Record",children:[f=="view"&&e.jsx(Re,{person:W}),f!="view"&&e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:u?me:de,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Pregnancy Record"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about the pregnancy record for the selected resident."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-y-2 md:gap-x-4 mb-5",children:[e.jsxs("div",{className:"md:row-span-2 flex flex-col md:col-span-2 items-center space-y-2",children:[e.jsx(Te,{htmlFor:"resident_image",value:"Profile Photo"}),e.jsx("img",{src:o.resident_image?`/storage/${o.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-sm border border-gray-200"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(Ae,{label:"Full Name",name:"fullname",value:o.resident_name||"",placeholder:"Select a resident",onChange:t=>ne(t),items:le}),e.jsx(b,{message:g.resident_id,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsx("div",{children:e.jsx(h,{label:"Birthdate",name:"birthdate",value:o.birthdate||"",placeholder:"Select a resident",readOnly:!0})}),e.jsx("div",{children:e.jsx(h,{label:"Sex",name:"sex",value:Se[o.sex||""],placeholder:"Select a resident",readOnly:!0})}),e.jsx("div",{children:e.jsx(h,{label:"Purok",name:"purok_number",value:o.purok_number||"",readOnly:!0})})]})]})]}),Array.isArray(o.pregnancy_records)&&o.pregnancy_records.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Me,{label:"Status",name:"status",value:t.status||"",onChange:r=>j(r.target.value,s,"status"),items:[{label:"Ongoing",value:"ongoing"},{label:"Delivered",value:"delivered"},{label:"Miscarried",value:"miscarried"},{label:"Aborted",value:"aborted"}]}),e.jsx(b,{message:g[`pregnancyRecords.${s}.status`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(h,{label:"Expected Due Date",type:"date",name:"expected_due_date",value:t.expected_due_date||"",onChange:r=>j(r.target.value,s,"expected_due_date")}),e.jsx(b,{message:g[`pregnancyRecords.${s}.expected_due_date`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(h,{label:"Delivery Date",type:"date",name:"delivery_date",value:t.delivery_date||"",onChange:r=>j(r.target.value,s,"delivery_date")}),e.jsx(b,{message:g[`pregnancyRecords.${s}.delivery_date`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsx(Fe,{label:"Notes",name:"notes",value:t.notes||"",onChange:r=>j(r.target.value,s,"notes"),placeholder:"Additional notes...",className:"text-gray-600"}),e.jsx(b,{message:g[`pregnancyRecords.${s}.notes`],className:"mt-1"})]})]}),u===null&&e.jsx("button",{type:"button",onClick:()=>ie(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(Pe,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[u===null?e.jsxs("button",{type:"button",onClick:oe,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx($e,{className:"text-2xl"}),e.jsx("span",{children:"Add Pregnancy Record"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[u==null&&e.jsxs(v,{type:"button",onClick:()=>L(),children:[e.jsx(He,{})," Reset"]}),e.jsxs(v,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[u?"Update":"Add"," ",e.jsx(Le,{})]})]})]})]})]}),e.jsx(Ie,{isOpen:K,onClose:()=>{S(!1)},onConfirm:pe,residentId:I})]})]})}export{Yt as default};
