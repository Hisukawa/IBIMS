import{K as Y,m as P,r as f,j as e,L as W}from"./app-BRf3vqP9.js";import G from"./BreadcrumbsHeader-CnzH8UfY.js";import{D as $}from"./DropdownInputField-DMvFqxb0.js";import{I as p}from"./InputError-BiMVZCOO.js";import{I as u}from"./InputField-C7XxlZN9.js";import{I as A}from"./InputLabel-BO4a4Xc7.js";import{I as K,a as U}from"./index-Ddn8R5LR.js";import{B as D}from"./button-CDzil7Gf.js";import{t as _,T as X}from"./index-C-WCcqBd.js";import"./switch-R7pDLd-t.js";import{R as q,e as m}from"./constants-BKolf-s5.js";import{S as z}from"./AdminLayout-VT8JU5PI.js";import{T as J}from"./textarea-BHtdAr0S.js";import{R as Q}from"./rotate-ccw-DFDfpj2D.js";import"./breadcrumb-C6DQjFRR.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./chevron-right-AYhXN9VI.js";import"./createLucideIcon-H0GndF87.js";import"./sidebar-CKmZXYje.js";import"./input-CTxl3FrY.js";import"./index-DgXwSCwS.js";import"./index-BU77-ztE.js";import"./floating-ui.react-dom-fzq-J6hA.js";import"./x-BIDYsk_1.js";import"./tooltip-BUuwggXN.js";import"./iconBase-Ba7t3Q5R.js";import"./index-Cc1h4NCK.js";import"./nav-user-Cuvz1KHW.js";import"./avatar-BRdab1OO.js";import"./dropdown-menu-bQpiNTAz.js";import"./check-DcMbiWhN.js";import"./useAppUrl-BoMt1iKY.js";import"./DeleteConfirmationModal-BX5sqCgC.js";import"./file-text-BOoT1o1S.js";import"./users-round-D814qYDK.js";import"./heart-pulse-OHw02mFe.js";import"./chevron-up-DNKTqBzq.js";function Te({residents:j}){var w;const E=[{label:"Medical Information",showOnMobile:!1},{label:"Child Health Monitoring Records",showOnMobile:!1,href:route("child_record.index")},{label:"Add Child Health Record",showOnMobile:!0}],h=Y().props,b=(h==null?void 0:h.success)??null,v=(h==null?void 0:h.error)??null,{data:i,setData:c,post:O,errors:g,reset:R}=P({resident_id:null,resident_name:"",birthdate:"",gender:"",resident_image:null,weight_kg:"",height_cm:"",bmi:"",head_circumference:"",nutrition_status:"",developmental_milestones:"",vaccinations:[{vaccine:"",vaccination_date:""}]}),F=t=>{t.preventDefault(),O(route("child_record.store"),{onError:s=>{const a=Object.values(s).map((d,l)=>`<div key=${l}> ${d}</div>`);_.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:a.join("")}}),duration:4e3,closeButton:!0})}})},T=t=>{var M,k;const s=j.find(o=>o.id==t);if(!s)return;let a="",d="";if(s.birthdate){const o=new Date(s.birthdate),x=new Date;a=x.getFullYear()-o.getFullYear();const S=x.getMonth()-o.getMonth(),L=x.getDate()-o.getDate();(S<0||S===0&&L<0)&&a--,d=(x.getFullYear()-o.getFullYear())*12+(x.getMonth()-o.getMonth()),x.getDate()<o.getDate()&&d--}const l=((M=s.medical_information)==null?void 0:M.weight_kg)||null,n=((k=s.medical_information)==null?void 0:k.height_cm)||null,r=s.sex||"";let C=null,I="";if(l&&n&&a&&r){const o=y(l,n,a);C=o.bmi,I=o.status}c(o=>({...o,resident_id:s.id,resident_name:`${s.firstname} ${s.middlename||""} ${s.lastname} ${s.suffix||""}`.trim(),birthdate:s.birthdate||"",sex:s.sex||"",resident_image:s.resident_picture_path||null,age:a,age_in_months:d,weight_kg:l,height_cm:n,bmi:C,nutrition_status:I,vaccinations:s.vaccinations}))},y=(t,s,a,d)=>{if(!t||!s||a==null)return{bmi:null,status:""};const l=s/100,n=t/(l*l);let r="";return a>=20?n<18.5?r=m.underweight:n<=24.9?r=m.normal:n<=29.9?r=m.overweight:r=m.obese:a>=5?n<15?r=m.severely_underweight:n<19?r=m.normal:n<23?r=m.overweight:r=m.obese:n<13?r=m.severely_underweight:n<14?r=m.underweight:n<=18?r=m.normal:n<=20?r=m.overweight:r=m.obese,{bmi:parseFloat(n.toFixed(2)),status:r}};f.useEffect(()=>{if(i.weight_kg&&i.height_cm){const{bmi:t,status:s}=y(i.weight_kg,i.height_cm,i.age,i.gender);c(a=>({...a,bmi:t,nutrition_status:s}))}else c(t=>({...t,bmi:null,nutrition_status:""}))},[i.weight_kg,i.height_cm]);const B=j.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),N=(t,s,a,d)=>{c(l=>{const r=[...Array.isArray(l[t])?l[t]:[]];return r[s]={...r[s],[a]:d},{...l,[t]:r}})},H=(t,s)=>{c(a=>({...a,[t]:[...a[t],s]}))},V=(t,s)=>{c(a=>({...a,[t]:a[t].filter((d,l)=>l!==s)}))};return f.useEffect(()=>{b&&(handleModalClose(),_.success(b,{description:"Operation successful!",duration:3e3,closeButton:!0})),h.success=null},[b]),f.useEffect(()=>{v&&_.error(v,{description:"Operation failed!",duration:3e3,closeButton:!0}),h.error=null},[v]),e.jsxs(z,{children:[e.jsx(X,{richColors:!0}),e.jsx(W,{title:"Medical Information"}),e.jsx(G,{breadcrumbs:E}),e.jsx("div",{children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{className:"overflow-hidden bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 my-8",children:e.jsxs("div",{className:" my-2 p-5",children:[v&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:v}),e.jsx("div",{children:e.jsxs("form",{onSubmit:F,children:[e.jsx("h2",{className:"text-3xl font-semibold text-gray-800 mb-1",children:"Child Health Monitoring"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Record weight, height, and health details for the selected resident."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-y-2 md:gap-x-4 mb-5",children:[e.jsxs("div",{className:"md:row-span-2 flex flex-col items-center space-y-2",children:[e.jsx(A,{htmlFor:"resident_image",value:"Profile Photo"}),e.jsx("img",{src:i.resident_image?`/storage/${i.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200"})]}),e.jsxs("div",{className:"md:col-span-5 space-y-2",children:[e.jsxs("div",{className:"w-full",children:[e.jsx($,{label:"Full Name",name:"fullname",value:i.resident_name||"",placeholder:"Select a resident",onChange:t=>T(t.target.value),items:B}),e.jsx(p,{message:g.resident_id,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-2",children:[e.jsx(u,{label:"Birthdate",name:"birthdate",value:i.birthdate||"",readOnly:!0}),e.jsx(u,{label:"Sex",name:"sex",value:q[i.sex||""],readOnly:!0}),e.jsx(u,{label:"Age",name:"age",value:i.age||"",readOnly:!0}),e.jsx(u,{label:"Age In Months",name:"age_in_months",value:i.age_in_months||"",readOnly:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 mb-5",children:[e.jsxs("div",{children:[e.jsx(u,{label:"Weight (kg)",name:"weight_kg",type:"number",step:"0.1",value:i.weight_kg,onChange:t=>c("weight_kg",t.target.value)}),e.jsx(p,{message:g.weight_kg,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{label:"Height (cm)",name:"height_cm",type:"number",step:"0.1",value:i.height_cm,onChange:t=>c("height_cm",t.target.value)}),e.jsx(p,{message:g.height_cm,className:"mt-2"})]}),e.jsx("div",{children:e.jsx(u,{label:"Nutrition Status",name:"nutrition_status",value:i.nutrition_status||"",placeholder:"Automatically determined",disabled:!0})}),e.jsxs("div",{children:[e.jsx(u,{label:"Head Circumference (cm)",name:"head_circumference",type:"number",step:"0.1",value:i.head_circumference,onChange:t=>c("head_circumference",t.target.value)}),e.jsx(p,{message:g.head_circumference,className:"mt-2"})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx(A,{htmlFor:"developmental_milestones",value:"Developmental Milestones",className:"mb-2"}),e.jsx(J,{id:"developmental_milestones",name:"developmental_milestones",placeholder:"Write observed developmental milestones here...",value:i.developmental_milestones,onChange:t=>c("developmental_milestones",t.target.value)}),e.jsx(p,{message:g.developmental_milestones,className:"mt-2"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Vaccinations"}),(w=i.vaccinations)==null?void 0:w.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsx($,{label:"Vaccine",name:`vaccinations.${s}.vaccine`,value:t.vaccine||"",placeholder:"Select a vaccine",onChange:a=>N("vaccinations",s,"vaccine",a.target.value)}),e.jsx(p,{message:g[`vaccinations.${s}.vaccine`],className:"mt-2"}),e.jsxs("div",{className:"mt-4",children:[e.jsx(u,{label:"Vaccination Date",name:`vaccinations.${s}.vaccination_date`,type:"date",value:t.vaccination_date||"",onChange:a=>N("vaccinations",s,"vaccination_date",a.target.value)}),e.jsx(p,{message:g[`vaccinations.${s}.vaccination_date`],className:"mt-2"})]}),i.vaccinations.length>1&&e.jsx("button",{type:"button",onClick:()=>V("vaccinations",s),className:"absolute top-1 right-2 text-sm text-red-500 hover:text-red-800",children:e.jsx(K,{className:"text-2xl"})})]},s)),e.jsxs("button",{type:"button",onClick:()=>H("vaccinations",{vaccine:"",vaccination_date:""}),className:"text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1 mb-6",children:[e.jsx(U,{className:"text-2xl"}),e.jsx("span",{children:"Add Vaccination"})]})]}),e.jsxs("div",{className:"flex w-full justify-end items-center mt-7 gap-4",children:[e.jsxs(D,{type:"button",onClick:()=>R(),children:[e.jsx(Q,{})," Reset"]}),e.jsx(D,{className:"w-40 bg-blue-700 hover:bg-blue-400",type:"submit",children:"Submit"})]})]})})]})})})})]})}export{Te as default};
