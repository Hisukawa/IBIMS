import{K as oe,r as a,j as t,L as ie,$ as U,S as f,a as M}from"./app-DluTzGHb.js";import le from"./BreadcrumbsHeader-Y2cXmDh4.js";import{S as ce}from"./AdminLayout-C6c7O0lg.js";import me from"./DynamicTableControls-BEolPDSu.js";import pe from"./DynamicTable-DoGyDRNI.js";import{F as ue}from"./FillterToggle-DBEPxxLr.js";import de from"./SidebarModal-D5hk8Ket.js";import xe from"./PersonDetailContent-DweGkZAM.js";import{B as _}from"./button-Dh7fzRxe.js";import{I as be}from"./input-CC5TkSWh.js";import{u as ge,s as ye,r as fe,v as w,w as _e,x as we,y as Ee,z as he,M as Te,m as Se,H as je,n as Ne,o as ve,p as Oe,R as De,b as Re}from"./constants-DMcup6PS.js";import He from"./ActionMenu-Csrc1Y8-.js";import{u as Ie}from"./useAppUrl-D9cToTnc.js";import{u as Ce}from"./useQuery-BsR9h68q.js";import ke from"./DeleteConfirmationModal-BzlNGbtB.js";import{t as F,T as Ae}from"./index-0PVT8G0g.js";import{S as Le}from"./search-9FvAwn6S.js";import{S as Pe}from"./share-2-D_mfeEVT.js";import{N as Ue}from"./network-D8boEuWk.js";import{E as Me}from"./eye-BV2fkW8i.js";import{S as Fe}from"./square-pen-DT4IBfsq.js";import{X as Xe}from"./x-CrNk9GF0.js";import"./breadcrumb-CQ8mNh-X.js";import"./chevron-right-C0HBejuY.js";import"./createLucideIcon-Ax5zlIWT.js";import"./sidebar-DATaBsqm.js";import"./index-BRJrdTSG.js";import"./index-CYvM7WXr.js";import"./floating-ui.react-dom-B6VSRzGx.js";import"./skeleton-BJ7hj38Q.js";import"./tooltip-CysDY4zj.js";import"./clsx-B-dksMZM.js";import"./nav-user-hJFFRtgC.js";import"./avatar-B8ztu7IH.js";import"./dropdown-menu-BXZ3MBVH.js";import"./check-ZTEKtxjY.js";import"./users-round-D7LnzO6_.js";import"./chevron-up-DZw0GgUV.js";import"./iconBase-BuSDbsmV.js";import"./index-BfWbB9AT.js";import"./index-Z_Y8QDqK.js";import"./ellipsis-DazvAe9f.js";function Ct({household_details:s,household_members:X,queryParams:$=null}){var R,H,I,C,k,A,L,P;const W=[{label:"Residents Information",showOnMobile:!1},{label:"Households",href:route("household.index"),showOnMobile:!1},{label:"Household Details",showOnMobile:!0}],E=Ie(),o=oe().props,p=(o==null?void 0:o.success)??null,u=(o==null?void 0:o.error)??null,{data:h,isLoading:$e,isError:We}=Ce({queryKey:["head",s.id],queryFn:async()=>{const{data:e}=await M.get(`${E}/household/getlatesthead/${s.id}`);return(e==null?void 0:e.head)||null},enabled:!!(s!=null&&s.id),staleTime:1e3*60*5}),i=$||{},[T,z]=a.useState(i.name??""),B=e=>{e.preventDefault(),d("name",T)},d=(e,r)=>{r&&r.trim()!==""?i[e]=r:delete i[e],i.page&&delete i.page,f.get(route("household.show",{household:s.id,...i}))},V=(e,r)=>{r.key==="Enter"&&d(e,r.target.value)},m=[{key:"resident_id",label:"Resident ID"},{key:"name",label:"Resident Name"},{key:"gender",label:"Gender"},{key:"age",label:"Age"},{key:"relationship_to_head",label:"Relationship to Head"},{key:"household_position",label:"Household Position"},{key:"employment_status",label:"Employment Status"},{key:"registered_voter",label:"Register Voter"},{key:"is_pwd",label:"Is PWD"},{key:"actions",label:"Actions"}],[Y,S]=a.useState(!1),[j,q]=a.useState(null),G=async e=>{try{const r=await M.get(`${E}/resident/showresident/${e}`);q(r.data.resident)}catch(r){console.error("Error fetching placeholders:",r)}S(!0)},[x,b]=a.useState(m.map(e=>e.key));a.useEffect(()=>{x.length===0&&b(m.map(e=>e.key))},[]);const[K,ze]=a.useState(!0),[N,Q]=a.useState(!1),g=Object.entries(i||{}).some(([e,r])=>["gender","age_group","relation","household_position","estatus","voter_status","is_pwd"].includes(e)&&r&&r!=="");a.useEffect(()=>{g&&O(!0)},[g]);const[v,O]=a.useState(g),J=()=>{window.print()},Z=e=>{f.get(route("resident.edit",e))},[ee,y]=a.useState(!1),[D,te]=a.useState(null),se=e=>{te(e),y(!0)},re=()=>{f.get(route("household.remove",D)),y(!1)},ae=e=>{if(!e)return"Unknown";const r=new Date(e),n=new Date;let l=n.getFullYear()-r.getFullYear();const c=n.getMonth()-r.getMonth();return(c<0||c===0&&n.getDate()<r.getDate())&&l--,l},ne={resident_id:e=>e.resident.id,name:e=>`${e.resident.firstname} ${e.resident.middlename??""} ${e.resident.lastname??""} ${e.resident.suffix??""}`,gender:e=>{const r=e.resident.gender,n=De[r]??"Unknown",l=Re[r]??"bg-gray-300";return t.jsx("span",{className:`py-1 px-2 rounded-xl text-sm font-medium ${l}`,children:n})},age:e=>{const r=ae(e.resident.birthdate);return typeof r!="number"?"Unknown":t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("span",{className:"font-medium text-gray-800",children:[r," years old"]}),r>60&&t.jsx("span",{className:"text-xs text-rose-600 font-semibold",children:"Senior Citizen"})]})},relationship_to_head:e=>Ne[e.relationship_to_head]||"",household_position:e=>je[e.household_position]||"",employment_status:e=>Se[e.resident.employment_status],registered_voter:e=>{var c;const r=((c=e.resident)==null?void 0:c.registered_voter)??0,n=ve[r]??"Unknown",l=Oe[r]??"p-1 bg-gray-300 text-black rounded-lg";return t.jsx("span",{className:l,children:n})},is_pwd:e=>{var r;return Te[(r=e.resident)==null?void 0:r.is_pwd]},actions:e=>t.jsx(He,{actions:[{label:"View",icon:t.jsx(Me,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>G(e.resident_id)},{label:"Edit",icon:t.jsx(Fe,{className:"w-4 h-4 text-green-500"}),onClick:()=>Z(e.resident_id)},{label:"Remove",icon:t.jsx(Xe,{className:"w-4 h-4 text-red-600"}),onClick:()=>se(e.resident_id)}]})};return a.useEffect(()=>{p&&F.success(p,{description:"Operation successful!",duration:3e3,closeButton:!0}),o.success=null},[p]),a.useEffect(()=>{u&&F.error(u,{description:"Operation failed!",duration:3e3,closeButton:!0}),o.error=null},[u]),t.jsxs(ce,{children:[t.jsx(ie,{title:"Family"}),t.jsx(Ae,{richColors:!0}),t.jsx(le,{breadcrumbs:W}),t.jsxs("div",{className:"bg-white shadow-md rounded-lg m-5 border border-gray-200",children:[t.jsxs("div",{className:"px-4 py-4 border-b bg-gray-100 rounded-t-lg",children:[t.jsxs("h2",{className:"text-2xl font-semibold text-gray-800",children:["House #",s.house_number]}),t.jsxs("p",{className:"text-sm text-gray-600",children:[((H=(R=s==null?void 0:s.purok)==null?void 0:R.barangay)==null?void 0:H.barangay_name)||""," ","• Purok ",((I=s==null?void 0:s.purok)==null?void 0:I.purok_number)||""," •"," ",((C=s==null?void 0:s.street)==null?void 0:C.street_name)||""," Street"]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-6",children:[{label:"Ownership Type",value:ge[s.ownership_type]},{label:"Housing Condition",value:ye[s.housing_condition]},{label:"Year Established",value:s.year_established},{label:"House Structure",value:fe[s.house_structure]},{label:"Bath & Wash Area",value:Array.isArray(s.bath_and_wash_area)?s.bath_and_wash_area.map(e=>w[e]||e).join(", "):typeof s.bath_and_wash_area=="object"?Object.values(s.bath_and_wash_area).map(e=>w[e]||e).join(", "):w[s.bath_and_wash_area]||s.bath_and_wash_area},{label:"Rooms",value:s.number_of_rooms},{label:"Floors",value:s.number_of_floors},{label:"Coordinates",value:`${s.latitude}, ${s.longitude}`},{label:"Toilet Types",value:((k=s.toilets)==null?void 0:k.length)>0?s.toilets.map(e=>_e[e.toilet_type]||e.toilet_type).join(", "):"None"},{label:"Waste Management Types",value:((A=s.waste_management_types)==null?void 0:A.length)>0?s.waste_management_types.map(e=>we[e.waste_management_type]||e.waste_management_type).join(", "):"None"},{label:"Water Source Types",value:((L=s.water_source_types)==null?void 0:L.length)>0?s.water_source_types.map(e=>Ee[e.water_source_type]||e.water_source_type).join(", "):"None"},{label:"Electricity Types",value:((P=s.electricity_types)==null?void 0:P.length)>0?s.electricity_types.map(e=>he[e.electricity_type]||e.electricity_type).join(", "):"None"}].map(({label:e,value:r},n)=>t.jsxs("div",{className:"flex justify-between border-b pb-2",children:[t.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[e,":"]}),t.jsx("span",{className:"text-sm text-gray-900 text-right max-w-[60%]",children:r||"—"})]},n))})]}),t.jsx("div",{className:"pt-4",children:t.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:t.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[t.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:t.jsx(me,{allColumns:m,visibleColumns:x,setVisibleColumns:b,onPrint:J,showFilters:v,toggleShowFilters:()=>O(e=>!e)})}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[t.jsxs("form",{onSubmit:B,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[t.jsx(be,{type:"text",placeholder:"Search for Household Member Name",value:T,onChange:e=>z(e.target.value),onKeyDown:e=>V("name",e),className:"w-full"}),t.jsxs("div",{className:"relative group z-50",children:[t.jsx(_,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:t.jsx(Le,{})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]})]}),t.jsx(U,{href:route("family.create"),children:t.jsxs("div",{className:"relative group z-50",children:[t.jsx(_,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",children:t.jsx(Pe,{className:"w-4 h-4"})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Relationship"})]})}),h&&t.jsx(U,{href:route("resident.familytree",h.resident_id),children:t.jsxs("div",{className:"relative group z-50",children:[t.jsx(_,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",children:t.jsx(Ue,{className:"w-4 h-4"})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Family Tree"})]})})]})]}),v&&t.jsx(ue,{queryParams:i,searchFieldName:d,visibleFilters:["gender","age_group","relation","household_position","estatus","voter_status","is_pwd"],showFilters:!0,clearRouteName:"household.show",clearRouteParams:{household:s.id}}),t.jsx(pe,{passedData:X,columnRenderers:ne,allColumns:m,is_paginated:K,toggleShowAll:()=>Q(!N),showAll:N,visibleColumns:x,setVisibleColumns:b})]})})}),t.jsx(de,{isOpen:Y,onClose:()=>S(!1),title:"Resident Details",children:j&&t.jsx(xe,{person:j})}),t.jsx(ke,{isOpen:ee,onClose:()=>{y(!1)},onConfirm:re,residentId:D,title:"Confirm Removal",message:"Are you sure you want to remove resident from this household? This action cannot be undone.",buttonLabel:"I UNDERSTAND, REMOVE"})]})}export{Ct as default};
