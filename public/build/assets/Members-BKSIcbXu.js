import{K as Ee,r as o,m as Ie,j as e,L as Me,S as te,a as se}from"./app-qIQ7IDh-.js";import{S as Re}from"./AdminLayout-_rQutR9r.js";import{B as y}from"./button-BfrawzaZ.js";import{I as Oe}from"./input-CUxmsB_K.js";import Ae from"./BreadcrumbsHeader-DJiRh6C_.js";import{t as p,T as Le}from"./index-CSRkQMHo.js";import Fe from"./DynamicTable-CO_N2vNI.js";import Te from"./ActionMenu-3kVZwSw4.js";import{R as Be,b as Ue}from"./constants-DG8YOv__.js";import He from"./SidebarModal-DyFoMFNU.js";import Ve from"./DynamicTableControls-cNZja1hJ.js";import ze from"./FillterToggle-BTmrFFxM.js";import{u as Pe}from"./useAppUrl-DAGftJCm.js";import Ke from"./PersonDetailContent-BIglwG5G.js";import Ge from"./DeleteConfirmationModal-5mon5EiH.js";import{D as Ye}from"./DropdownInputField-QxHlSbS4.js";import{I as R}from"./InputError-X9OUwrPU.js";import{I as O}from"./InputLabel-BERaxW3C.js";import{I as A}from"./InputField-PSV6WqI0.js";import{I as Qe,a as Xe,b as Je}from"./index-ChFgTMKG.js";import{E as We}from"./ExportButton-BBsrzMfu.js";import{S as Ze}from"./switch-37CgzP3D.js";import{U as qe}from"./users-round-CHlmtbBl.js";import{S as et}from"./search-BAASt7uc.js";import{L as tt}from"./list-plus-B0Bhsq0G.js";import{R as st}from"./rotate-ccw-CUaR0CWM.js";import{E as rt}from"./eye-Cj0sFi96.js";import{S as at}from"./square-pen-DPOwp_Ea.js";import{T as it}from"./trash-2-BEOEgR3Q.js";import"./sidebar-_Csff4rX.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-DgkjhZpM.js";import"./index-CczSKsTO.js";import"./floating-ui.react-dom-CxNnqrK8.js";import"./x-DASonJQW.js";import"./createLucideIcon-BfPbDvGd.js";import"./tooltip-lpRyLyg7.js";import"./nav-user-Bs-bErxJ.js";import"./avatar-UAvF2-7y.js";import"./dropdown-menu-D2Wifm12.js";import"./check-CYXhCgKq.js";import"./chevron-right-opMbK2PD.js";import"./stringFormat-Dx_XIxG1.js";import"./file-text-CqTlswnC.js";import"./heart-pulse-Bz4H3bon.js";import"./chevron-up-PxGaJMxl.js";import"./breadcrumb-ClEeUCyG.js";import"./ellipsis-DQ3NCbUF.js";import"./react-datepicker-BCPFkBGL.js";import"./index-CnWk7Wbn.js";import"./iconBase-BKzBmVSP.js";import"./index-DzZZSx7g.js";import"./index-xOZIErY5.js";import"./file-output-BeOK75cf.js";function ls({members:N,puroks:re,queryParams:n,residents:L,institution:x}){const ae=[{label:"Barangay Information",showOnMobile:!1},{label:"Institution",showOnMobile:!1},{label:"Institution Members",showOnMobile:!0}];n=n||{};const F=Pe(),d=Ee().props,w=(d==null?void 0:d.success)??null,S=(d==null?void 0:d.error)??null,[ie,k]=o.useState(!1),[T,ne]=o.useState(null),[b,D]=o.useState(null),[B,le]=o.useState(n.name??""),[oe,j]=o.useState(!1),[C,v]=o.useState(""),[U,H]=o.useState(null),de=N.some(t=>t.is_head===1||t.is_head===!0),c=N.find(t=>t.is_head===1||t.is_head===!0),me=t=>{t.preventDefault(),$("name",B)},$=(t,s)=>{s&&s.trim()!==""?n[t]=s:delete n[t],n.page&&delete n.page,te.get(route("barangay_institution.show",x.id),n)},ce=(t,s)=>{if(s.key==="Enter")$(t,s.target.value);else return},E=[{key:"id",label:"ID"},{key:"name",label:"Resident Name"},{key:"sex",label:"Sex"},{key:"age",label:"Age"},{key:"birthdate",label:"Date of Birth"},{key:"member_since",label:"Date of Membership"},{key:"status",label:"Status"},{key:"contact_number",label:"Contact Number"},{key:"purok_number",label:"Purok Number"},{key:"actions",label:"Actions"}],ue=L.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),[V,z]=o.useState(E.map(t=>t.key)),I=Object.entries(n||{}).some(([t,s])=>["purok","sex","age_group","pwd","fourps","solo_parent"].includes(t)&&s&&s!=="");o.useEffect(()=>{I&&K(!0)},[I]);const[P,K]=o.useState(I),pe=()=>{window.print()},xe=t=>{if(!t)return"Unknown";const s=new Date(t),r=new Date;let a=r.getFullYear()-s.getFullYear();const l=r.getMonth()-s.getMonth();return(l<0||l===0&&r.getDate()<s.getDate())&&a--,a},be={id:t=>e.jsx("span",{className:"text-xs font-semibold text-gray-500",children:t.id}),name:t=>{const s=t.resident,r=t.is_head===1;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium text-gray-800",children:[s.firstname," ",s.middlename??""," ",s.lastname," ",e.jsx("span",{className:"text-gray-500",children:s.suffix??""})]}),r&&e.jsx("span",{className:"px-2 py-0.5 text-[10px] font-semibold rounded-full bg-blue-100 text-blue-800",children:"Head"})]})},sex:t=>{var l,h,g;const s=(l=t.resident)==null?void 0:l.sex,r=((h=Be)==null?void 0:h[s])??s??"Unknown",a=((g=Ue)==null?void 0:g[s])??"bg-gray-100 text-gray-800";return e.jsx("span",{className:`py-1 px-3 rounded-full text-xs font-semibold shadow-sm whitespace-nowrap ${a}`,children:r})},contact_number:t=>{var a;const s=(a=t.resident)==null?void 0:a.contact_number,r=s||"—";return e.jsx("span",{className:"text-xs font-medium text-gray-700 capitalize",children:r})},age:t=>{const s=t.resident,r=xe(s.birthdate);return r===null?e.jsx("span",{className:"italic text-gray-400",children:"Unknown"}):e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsxs("span",{className:"font-bold text-indigo-700",children:[r," yrs"]}),r>60&&e.jsx("span",{className:"text-xs text-rose-500 font-semibold mt-0.5",children:"Senior Citizen"})]})},birthdate:t=>{var s;return(s=t.resident)!=null&&s.birthdate?e.jsx("span",{className:"text-gray-700 text-sm",children:new Date(t.resident.birthdate).toLocaleDateString()}):e.jsx("span",{className:"italic text-gray-400",children:"—"})},member_since:t=>t.member_since?e.jsx("span",{className:"text-indigo-600 font-medium text-sm",children:new Date(t.member_since).toLocaleDateString()}):e.jsx("span",{className:"italic text-gray-400",children:"—"}),status:t=>{const s=t.status,r={active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-700"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold shadow-sm ${r[s]??"bg-gray-100 text-gray-600"}`,children:s})},purok_number:t=>{var s;return e.jsx("span",{className:"text-gray-700 font-medium",children:((s=t.resident)==null?void 0:s.purok_number)??"—"})},actions:t=>e.jsx(Te,{actions:[{label:"View",icon:e.jsx(rt,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>{var s;return ke((s=t.resident)==null?void 0:s.id)}},{label:"Edit",icon:e.jsx(at,{className:"w-4 h-4 text-green-500"}),onClick:()=>Ne(t.id)},{label:"Delete",icon:e.jsx(it,{className:"w-4 h-4 text-red-600"}),onClick:()=>we(t.id)}]})},{data:u,setData:m,post:G,errors:_,reset:Y,clearErrors:he}=Ie({members:[{resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,member_since:"",status:"active",is_head:!1}],institution_id:null,member_id:null,_method:void 0}),ge=(t,s)=>{const r=L.find(l=>l.id==t.target.value),a=[...u.members];a[s]={...a[s],resident_id:(r==null?void 0:r.id)||null,resident_name:`${r.firstname} ${r.middlename} ${r.lastname} ${r.suffix??""}`||"",birthdate:(r==null?void 0:r.birthdate)||null,purok_number:(r==null?void 0:r.purok_number)||null,resident_image:(r==null?void 0:r.image)||null},m("members",a),m("institution_id",x.id)},M=(t,s,r)=>{const a=[...u.members];a[s][r]=t.target.type==="checkbox"?t.target.checked:t.target.value,m("members",a)},fe=()=>{m("members",[...u.members,{resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,member_since:"",status:"active",is_head:!1}])},je=t=>{const s=[...u.members];s.splice(t,1),m("members",s),p.warning("Member removed.",{duration:2e3})},ve=()=>{v("add"),j(!0)},_e=t=>{t.preventDefault(),G(route("institution_member.store"),{onError:s=>{const r=Object.values(s).map((a,l)=>`<div key=${l}> ${a}</div>`);p.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:r.join("")}}),duration:4e3,closeButton:!0})}})},ye=t=>{t.preventDefault(),G(route("institution_member.update",u.member_id),{onError:()=>{const s=Object.values(_).map((r,a)=>`<div key=${a}> ${r}</div>`);p.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.join("")}}),duration:4e3,closeButton:!0})}})},Q=()=>{v(null),j(!1),H(null),D(null),Y(),he()},Ne=async t=>{var s,r,a,l,h,g,X,J,W,Z,q;v("add"),D(null);try{const i=(await se.get(`${F}/institution_member/details/${t}`)).data.member;D(i),m("member_id",i.id),m("_method","PUT"),m("members",[{resident_id:((s=i.resident)==null?void 0:s.id)??null,resident_name:`${((r=i.resident)==null?void 0:r.firstname)??""} ${((a=i.resident)==null?void 0:a.middlename)??""} ${((l=i.resident)==null?void 0:l.lastname)??""} ${((h=i.resident)==null?void 0:h.suffix)??""}`.trim(),resident_image:((g=i.resident)==null?void 0:g.image)??null,birthdate:((X=i.resident)==null?void 0:X.birthdate)??null,purok_number:((J=i.resident)==null?void 0:J.purok_number)??null,member_since:i.member_since??"",status:i.status??"active",is_head:i.is_head??!1}])}catch(f){console.error("Error fetching member details:",f);let i="Error",ee="Something went wrong. Please try again.";if(((W=f.response)==null?void 0:W.status)===422&&((q=(Z=f.response)==null?void 0:Z.data)!=null&&q.errors)){i="Validation Error";const De=Object.values(f.response.data.errors).flat();ee=e.jsx("ul",{className:"list-disc ml-5",children:De.map((Ce,$e)=>e.jsx("li",{children:Ce},$e))})}p.error(i,{description:ee,duration:4e3,closeButton:!0})}finally{j(!0)}},we=t=>{ne(t),k(!0)},Se=()=>{te.delete(route("institution_member.destroy",T),{onError:t=>{const s=Object.values(t).map((r,a)=>`<div key=${a}> ${r}</div>`);p.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.join("")}}),duration:4e3,closeButton:!0})}}),k(!1)},ke=async t=>{v("view");try{const s=await se.get(`${F}/resident/showresident/${t}`);H(s.data.resident)}catch(s){console.error("Error fetching placeholders:",s)}j(!0)};return o.useEffect(()=>{w&&(Q(),p.success(w,{description:"Operation successful!",duration:3e3,closeButton:!0})),d.success=null},[w]),o.useEffect(()=>{S&&p.error(S,{description:"Operation failed!",duration:3e3,closeButton:!0}),d.error=null},[S]),e.jsxs(Re,{children:[e.jsx(Me,{title:"Resident Information"}),e.jsxs("div",{children:[e.jsx(Le,{richColors:!0}),e.jsx(Ae,{breadcrumbs:ae}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 p-4 bg-gray-50 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(qe,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:[x.name," Overview"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Review, filter, and manage members of ",x.name," ","efficiently."]})]})]}),c&&e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow-md border border-gray-100 w-64",children:[e.jsx("h2",{className:"text-xs font-semibold text-gray-500 tracking-wide uppercase",children:"Head of Institution"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:`${(c.resident.firstname||"").charAt(0).toUpperCase()+(c.resident.firstname||"").slice(1).toLowerCase()} ${(c.resident.lastname||"").charAt(0).toUpperCase()+(c.resident.lastname||"").slice(1).toLowerCase()}`}),c.resident.contact_number?e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Contact:"})," ",c.resident.contact_number]}):e.jsx("p",{className:"text-sm text-gray-400 italic mt-1",children:"No contact number provided"})]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx(Ve,{allColumns:E,visibleColumns:V,setVisibleColumns:z,onPrint:pe,showFilters:P,toggleShowFilters:()=>K(t=>!t)}),e.jsx(We,{url:`/report/export-institution-members-pdf/${x.id}`,queryParams:n,label:"Export Members as PDF",type:"pdf"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:me,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(Oe,{type:"text",placeholder:"Search Resident Name",value:B,onChange:t=>le(t.target.value),onKeyDown:t=>ce("name",t.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(y,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(et,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(y,{className:"bg-blue-700 hover:bg-blue-400 ",type:"button",onClick:ve,children:e.jsx(tt,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Institution Member"})]})]})})]}),P&&e.jsx(ze,{queryParams:n,searchFieldName:$,visibleFilters:["purok","sex","age_group","pwd","fourps","solo_parent"],puroks:re,showFilters:!0,clearRouteName:"barangay_institution.show",clearRouteParams:{id:x.id}}),e.jsx(Fe,{passedData:N,allColumns:E,columnRenderers:be,queryParams:n,visibleColumns:V,setVisibleColumns:z})]})})}),e.jsxs(He,{isOpen:oe,onClose:Q,title:C==="add"?b?"Edit Resident Death Details":"Add Resident Death Details":"View Resident Details",children:[C==="add"&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:b?ye:_e,children:[u.members.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 mb-3 flex items-center gap-2",children:["Institution Member –"," ",t.resident_name||"Select a Resident"]}),e.jsx("p",{className:"text-gray-600 mb-6 text-sm",children:"Please provide the membership details of the resident, including their status and role."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-y-2 md:gap-x-4 mb-5 w-full",children:[e.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(O,{htmlFor:`resident_image_${s}`,value:"Profile Photo"}),e.jsx("img",{src:t.resident_image?`/storage/${t.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsx(Ye,{label:"Full Name",name:`members.${s}.resident_name`,value:t.resident_name||"",placeholder:"Select a resident",onChange:r=>ge(r,s),items:ue}),e.jsx(R,{message:_[`members.${s}.resident_id`],className:"mt-2"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx(A,{label:"Birthdate",name:`members.${s}.birthdate`,value:t.birthdate||"",readOnly:!0}),e.jsx(A,{label:"Purok Number",name:`members.${s}.purok_number`,value:t.purok_number||"",readOnly:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-5",children:[e.jsxs("div",{children:[e.jsx(O,{value:"Member Since"}),e.jsx(A,{type:"date",name:`members.${s}.member_since`,value:t.member_since||"",onChange:r=>M(r,s,"member_since")}),e.jsx(R,{message:_[`members.${s}.member_since`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(O,{value:"Status"}),e.jsxs("select",{name:`members.${s}.status`,value:t.status||"active",onChange:r=>M(r,s,"status"),className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 text-sm",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsx(R,{message:_[`members.${s}.status`],className:"mt-2"})]})]}),(!de||t.is_head)&&e.jsxs("div",{className:"flex items-center gap-3 mt-3",children:[e.jsx(Ze,{id:`is_head_${s}`,checked:!!t.is_head,onCheckedChange:r=>M({target:{value:r}},s,"is_head")}),e.jsx("label",{htmlFor:`is_head_${s}`,className:"text-sm font-medium text-gray-700",children:"Set as Head of Institution"})]})]})]}),u.members.length>1&&e.jsx("button",{type:"button",onClick:()=>je(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium transition-colors duration-200",children:e.jsx(Qe,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[b===null?e.jsxs("button",{type:"button",onClick:fe,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Xe,{className:"text-2xl"}),e.jsx("span",{children:"Add Member"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[b===null&&e.jsxs(y,{type:"button",onClick:()=>Y(),children:[e.jsx(st,{})," Reset"]}),e.jsxs(y,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[b?"Update":"Add"," ",e.jsx(Je,{})]})]})]})]})}),C==="view"&&U?e.jsx(Ke,{person:U}):null]}),e.jsx(Ge,{isOpen:ie,onClose:()=>{k(!1)},onConfirm:Se,residentId:T})]})]})}export{ls as default};
