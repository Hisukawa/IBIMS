import{K as ue,r as i,m as xe,j as e,L as pe,S as T,a as O}from"./app-BDFxb8TA.js";import{S as he,C as ge}from"./AdminLayout-CM3_VNfS.js";import{B as N}from"./button-CpOsaw8_.js";import{I as be}from"./input-jJkVEZh6.js";import fe from"./BreadcrumbsHeader-BjgQDL1u.js";import{T as je,t as c}from"./index-BV4yT7DH.js";import ve from"./DynamicTable-CHhkyrvT.js";import ye from"./ActionMenu-B1t3zEf2.js";import{R as Ne,a as we}from"./constants-a7o6YRsm.js";import _e from"./SidebarModal-BzXA3oBB.js";import Se from"./DynamicTableControls-Be3FEhX9.js";import Ee from"./FillterToggle-D90xyrDX.js";import{u as Ce}from"./useAppUrl-8JzvxBJd.js";import De from"./PersonDetailContent-BjbM7UZK.js";import Ae from"./DeleteConfirmationModal-BmD4yp-x.js";import{u as ke}from"./handleResidentChange-BBryeIGk.js";import{D as Re}from"./DropdownInputField-iTn69Qsd.js";import{I as Ie}from"./InputError-DeIudV3g.js";import{I as $e}from"./InputLabel-DqkNamG1.js";import{I as x}from"./InputField-oCrZeJoU.js";import{P as Te}from"./PasswordValidationChecklist-rz5NEL_M.js";import{E as Oe}from"./EmailValidationInput-BG3LzXyp.js";import{S as Ue}from"./switch-5PySSEYu.js";import{S as Me}from"./SelectField-DYDkNw60.js";import{S as Be}from"./search-DYm-wMZU.js";import{S as Fe}from"./square-plus-BzG-3LGZ.js";import{M as Le}from"./move-right-CixI-RDw.js";import{P as Pe}from"./pencil-D54CRqa1.js";import{T as Ve}from"./trash-2-D0zHUyfY.js";import"./sidebar-DTvw3aXB.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-XCqKAzY-.js";import"./index-DkI8As0p.js";import"./floating-ui.react-dom-CH_KqBmZ.js";import"./x-BwVgvZTi.js";import"./createLucideIcon-tGOSRdoQ.js";import"./tooltip-w_xHr43J.js";import"./nav-user-BI5LsarM.js";import"./avatar-uAJ5rm9d.js";import"./dropdown-menu-enabQI5J.js";import"./check-BVd6L0zb.js";import"./chevron-right-CYSwUaqK.js";import"./stringFormat-Dx_XIxG1.js";import"./file-text-F4iMt6p7.js";import"./users-round-CP9XJTu1.js";import"./heart-pulse-DPuDzfZz.js";import"./chevron-up-D85Lw7mi.js";import"./breadcrumb-DUDN2ulf.js";import"./ellipsis-fOBkrL-4.js";import"./react-datepicker-bgVyIYaD.js";import"./index-Cxc8uHiV.js";import"./iconBase-D4DM0745.js";import"./index-2GrJY7_j.js";import"./index-CSUEvA4p.js";function Jt({accounts:w,queryParams:o,residents:_}){const U=[{label:"Barangay Information",showOnMobile:!1},{label:"Accounts",showOnMobile:!0}];o=o||{};const M=Ce(),m=ue().props,S=(m==null?void 0:m.success)??null;m==null||m.error;const[B,g]=i.useState(!1),[F,L]=i.useState(null),[E,P]=i.useState(null),[C,V]=i.useState(o.name??""),[z,b]=i.useState(!1),[l,f]=i.useState(""),[D,H]=i.useState(null),[K,ze]=i.useState(""),J=t=>{t.preventDefault(),j("name",C)},j=(t,s)=>{s&&s.trim()!==""?o[t]=s:delete o[t],o.page&&delete o.page,T.get(route("user.index",o))},X=(t,s)=>{if(s.key==="Enter")j(t,s.target.value);else return},G=_.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),v=[{key:"id",label:"ID"},{key:"resident_name",label:"Full Name"},{key:"name",label:"User Name"},{key:"email",label:"Email"},{key:"role",label:"Role"},{key:"status",label:"Session Status"},{key:"account_status",label:"Account Status"},{key:"logged_in",label:"Last Logged In"},{key:"created_at",label:"Date Added"},{key:"actions",label:"Actions"}],y=Object.entries(o||{}).some(([t,s])=>["session_status","account_status"].includes(t)&&s&&s!=="");i.useEffect(()=>{y&&k(!0)},[y]);const[A,k]=i.useState(y),[Q,He]=i.useState(!0),[R,W]=i.useState(!1),[Y,I]=i.useState(w.data.reduce((t,s)=>(t[s.id]=!s.is_disabled,t),{})),Z={id:t=>e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:t.id}),resident_name:t=>{const s=t.resident??{},n=`${s.firstname??""} ${s.middlename??""} ${s.lastname??""} ${s.suffix??""}`.trim();return e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:n||"—"})},name:t=>e.jsx("span",{className:"text-sm font-medium text-gray-800",children:t.username??"—"}),email:t=>e.jsx("span",{className:"text-xs text-gray-600",children:t.email??"—"}),role:t=>e.jsx("span",{className:`text-xs font-medium ${t.role==="barangay_officer"?"text-indigo-600":t.role==="resident"?"text-green-600":"text-gray-400"}`,children:we[t.role]??"—"}),status:t=>{var n;const s=t.status==="active";return e.jsx("span",{className:`
                    text-xs font-semibold px-3 py-1 rounded-full transition
                    ${s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}
                    hover:shadow-sm
                `,children:((n=t.status)==null?void 0:n.toUpperCase())??"—"})},logged_in:t=>{const s=t.updated_at?new Date(t.updated_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—";return e.jsx("span",{className:"text-xs text-gray-500",children:s})},account_status:t=>{const s=Y[t.id]??!0,n=a=>{I(d=>({...d,[t.id]:a})),O.patch(`/user/${t.id}/toggle-account`,{is_disabled:a?0:1}).then(d=>{d.data.success?c.success(d.data.message,{duration:3e3,closeButton:!0}):c.error(d.data.message||"Something went wrong.",{duration:3e3,closeButton:!0})}).catch(()=>{c.error("Failed to update account status.",{duration:3e3,closeButton:!0}),I(d=>({...d,[t.id]:!a}))})};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ue,{checked:s,onCheckedChange:n,className:"bg-gray-200 hover:bg-gray-300"}),e.jsx("span",{className:`text-xs font-semibold ${s?"text-green-700":"text-red-700"}`,children:s?"ENABLED":"DISABLED"})]})},created_at:t=>{const s=t.created_at?new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"—";return e.jsx("span",{className:"text-xs text-gray-500",children:s})},actions:t=>e.jsx(ye,{actions:[{label:"Edit",icon:e.jsx(Pe,{className:"w-4 h-4 text-blue-600"}),onClick:()=>le(t.id)},{label:"Delete",icon:e.jsx(Ve,{className:"w-4 h-4 text-red-600"}),onClick:()=>de(t.id)}]})},{data:r,setData:u,post:$,errors:q,reset:ee,clearErrors:te}=xe({resident_id:null,resident_name:"",resident_image:null,birthdate:"",purok_number:"",sex:"",username:"",email:"",password:"",password_confirmation:"",role:"",status:"active",is_disabled:!1,account_id:null,_method:void 0}),se=ke(_,u),ae=v.map(t=>t.key),[p,re]=i.useState(()=>{const t=localStorage.getItem("accounts_visible_columns");return t?JSON.parse(t):ae});i.useEffect(()=>{localStorage.setItem("accounts_visible_columns",JSON.stringify(p))},[p]);const h=()=>{f(null),b(!1),H(null),L(null),ee(),te()},ne=()=>{f("add"),b(!0)},ie=t=>{t.preventDefault(),$(route("user.store"),{onSuccess:()=>{c.success("User account saved successfully!",{description:"The changes have been saved.",duration:3e3,closeButton:!0}),h()},onError:s=>{const n=Object.values(s).map((a,d)=>`<div key=${d}> ${a}</div>`);c.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:n.join("")}}),duration:4e3,closeButton:!0})}})},le=async t=>{try{const n=(await O.get(`${M}/user/${t}`)).data,a=n.resident;f("edit"),b(!0),u({resident_id:n.resident_id,resident_name:a?`${a.firstname} ${a.middlename} ${a.lastname} ${a.suffix??""}`.trim():"",resident_image:(a==null?void 0:a.image)||null,birthdate:(a==null?void 0:a.birthdate)||"",purok_number:(a==null?void 0:a.purok_number)||"",sex:(a==null?void 0:a.sex)||"",username:n.username,email:n.email,role:n.role,originalEmail:n.email,password:"",password_confirmation:"",account_id:n.id,_method:"PUT"})}catch(s){console.error("Error fetching account details:",s),c.error("Failed to fetch account details.")}},oe=t=>{t.preventDefault(),r.account_id&&$(route("user.update",r.account_id),{onSuccess:()=>{c.success("User account updated successfully!",{description:"The changes have been saved.",duration:3e3,closeButton:!0}),h()},onError:s=>{const n=Object.values(s).map((a,d)=>`<div key=${d}>${a}</div>`);c.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:n.join("")}}),duration:4e3,closeButton:!0})}})},de=t=>{P(t),g(!0)},ce=()=>{T.delete(route("user.destroy",E)),g(!1),S&&(h(),c.success(S,{description:"Operation successful!",duration:3e3,closeButton:!0})),m.success=null},me=()=>{window.print()};return e.jsxs(he,{children:[e.jsx(pe,{title:"Resident Information"}),e.jsxs("div",{children:[e.jsx(je,{richColors:!0}),e.jsx(fe,{breadcrumbs:U}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(ge,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"User Accounts"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Manage and monitor"," ",e.jsx("span",{className:"font-medium",children:"user accounts"})," ","within the system. Use the tools below to"," ",e.jsx("span",{className:"font-medium",children:"create, update, filter, or export"})," ","information for administration and reports."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(Se,{allColumns:v,visibleColumns:p,setVisibleColumns:re,onPrint:me,showFilters:A,toggleShowFilters:()=>k(t=>!t)})}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:J,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(be,{type:"text",placeholder:"Search Resident Name",value:C,onChange:t=>V(t.target.value),onKeyDown:t=>X("name",t.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(N,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Be,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(N,{className:"bg-blue-700 hover:bg-blue-400 ",type:"button",onClick:ne,children:e.jsx(Fe,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Account"})]})]})})]}),A&&e.jsx(Ee,{queryParams:o,searchFieldName:j,visibleFilters:["session_status","account_status","account_role"],showFilters:!0,clearRouteName:"user.index",clearRouteParams:{}}),e.jsx(ve,{passedData:w,allColumns:v,columnRenderers:Z,queryParams:o,is_paginated:Q,toggleShowAll:()=>W(!R),showAll:R,visibleColumns:p})]})})}),e.jsxs(_e,{isOpen:z,onClose:h,title:l==="add"?F?"Edit Account Details":"Add Account Details":"View Resident Details",children:[(l==="add"||l==="edit")&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:l==="add"?ie:oe,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2",children:[l==="add"?"Create User Account – ":"Edit User Account – ",r.resident_name||"Select a Resident"]}),e.jsx("p",{className:"text-gray-600 text-sm",children:l==="add"?"Please select a resident and provide the account credentials (username, email, and password).":"Update the account credentials and status (password cannot be changed here)."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 p-6 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[e.jsx($e,{htmlFor:"resident_image",value:"Profile Photo"}),e.jsx("img",{src:r.resident_image?`/storage/${r.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow"}),e.jsx("p",{className:"text-sm text-gray-500 text-center",children:r.resident_id?"Preview of the selected resident":"Select a resident to view details"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-5",children:[e.jsxs("div",{children:[e.jsx(Re,{label:"Full Name",name:"resident_name",value:r.resident_name||"",placeholder:"Select a resident",onChange:se,items:G,disabled:l==="edit"}),e.jsx(Ie,{message:q.resident_id,className:"mt-1"})]}),r.resident_id&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{label:"Birthdate",name:"birthdate",value:r.birthdate||"",readOnly:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Resident's birthdate"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Purok Number",name:"purok_number",value:r.purok_number||"",readOnly:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Resident's assigned Purok"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Sex",name:"sex",value:Ne[r.sex]||"",readOnly:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Resident's gender"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-6 rounded-xl shadow-sm space-y-6",children:[e.jsx("h4",{className:"text-xl font-semibold text-gray-800",children:"Account Credentials"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{label:"Username",name:"username",value:r.username||"",onChange:t=>u("username",t.target.value)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Enter a unique username for login (letters, numbers, underscores allowed)."})]}),e.jsxs("div",{children:[e.jsx(Oe,{data:r,setData:u,originalEmail:r.originalEmail??null}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Enter a valid email address. This will be used for notifications and login."})]}),e.jsxs("div",{children:[e.jsx(Me,{label:"Role",name:"role",value:r.role||"",onChange:t=>u("role",t.target.value),items:[{value:"barangay_officer",label:"Barangay Officer"},{value:"resident",label:"Resident"}]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:'Select the account role. "Barangay Officer" has admin privileges; "Resident" has limited access.'})]})]}),l==="add"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{label:"Password",name:"password",type:"password",value:r.password||"",onChange:t=>u("password",t.target.value)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Use at least 8 characters, including uppercase, lowercase, numbers, and symbols."})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Confirm Password",name:"password_confirmation",type:"password",value:r.password_confirmation||"",onChange:t=>u("password_confirmation",t.target.value)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Re-enter the password to confirm."})]})]}),l==="add"&&e.jsx(Te,{data:r})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(N,{className:"bg-blue-700 hover:bg-blue-400 flex justify-end",type:"submit",disabled:l==="add"&&(!!K||!r.password||!r.password_confirmation),children:[l==="add"?"Create Account":"Update Account"," ",e.jsx(Le,{})]})})]})}),l==="view"&&D?e.jsx(De,{person:D}):null]}),e.jsx(Ae,{isOpen:B,onClose:()=>{g(!1)},onConfirm:ce,residentId:E})]})]})}export{Jt as default};
