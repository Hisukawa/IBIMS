import{K as pe,r as o,m as xe,j as e,L as he,S as F,a as R}from"./app-FQbzxGIw.js";import{S as ge,C as fe}from"./AdminLayout-D681-fmM.js";import{B as _}from"./button-9tywdtpe.js";import{I as be}from"./input-BxejiG4V.js";import je from"./BreadcrumbsHeader-BKQz8BHC.js";import{t as c,T as ve}from"./index-CMTh6Y7Z.js";import we from"./DynamicTable-BMSA2BaJ.js";import ye from"./ActionMenu-CzwL-S4C.js";import Ne from"./SidebarModal-DD4dEoye.js";import _e from"./DynamicTableControls-Dp8-Etap.js";import{F as Se}from"./FillterToggle-C5Vn0ru6.js";import{u as Ce}from"./useAppUrl-zATTBKeL.js";import Ae from"./PersonDetailContent-Bnjnk2Nd.js";import De from"./DeleteConfirmationModal-B0Xpw4Vn.js";import{u as Ee}from"./handleResidentChange-CLr1V6n4.js";import{D as ke}from"./DropdownInputField-D0XusS6V.js";import{I as Ie}from"./InputError-BKQpvrj7.js";import{I as $e}from"./InputLabel-BRo6d_Ci.js";import{I as p}from"./InputField-DUwBnDWI.js";import{P as Me}from"./PasswordValidationChecklist-Bcx6LI8D.js";import{E as Oe}from"./EmailValidationInput-DpD9OzAz.js";import{S as Fe}from"./switch-zvStcstV.js";import{S as Re}from"./search-BMvlfdsT.js";import{S as Ue}from"./square-plus--VaQgaU-.js";import{M as Be}from"./move-right-Bmm93ya7.js";import{P as Le}from"./pencil-BE3QrpDq.js";import{T as Te}from"./trash-2-DbTjliIz.js";import"./sidebar-kMsPs0kt.js";import"./index-D9GFQlD6.js";import"./index-BvtReL5S.js";import"./floating-ui.react-dom-Bv5Tn9NB.js";import"./x-SzE7BJuj.js";import"./createLucideIcon-CbmRPBK-.js";import"./skeleton-C5JXX0Vb.js";import"./tooltip-D5qIOJrT.js";import"./nav-user-NQ1-22E_.js";import"./avatar-B4QdFqbk.js";import"./dropdown-menu-Mj4r6j7K.js";import"./check-KP9WahT6.js";import"./chevron-right-KG4eDgaU.js";import"./users-round-fHMLq3qJ.js";import"./chevron-up-D1MoY1rl.js";import"./clsx-B-dksMZM.js";import"./breadcrumb-CZJEnQm8.js";import"./ellipsis-CzsbrfyR.js";import"./constants-0uClA9D3.js";import"./iconBase-C4pIma2P.js";import"./index-DPWqtkCr.js";import"./index-BDSYX5a9.js";function Bt({accounts:S,queryParams:l,residents:C}){const U=[{label:"Barangay Information",showOnMobile:!1},{label:"Accounts",showOnMobile:!0}];l=l||{};const B=Ce(),m=pe().props,h=(m==null?void 0:m.success)??null,g=(m==null?void 0:m.error)??null,[L,f]=o.useState(!1),[T,P]=o.useState(null),[A,V]=o.useState(null),[D,z]=o.useState(l.name??""),[H,b]=o.useState(!1),[i,j]=o.useState(""),[E,K]=o.useState(null),[J,Pe]=o.useState(""),Q=t=>{t.preventDefault(),v("name",D)},v=(t,s)=>{s&&s.trim()!==""?l[t]=s:delete l[t],l.page&&delete l.page,F.get(route("user.index",l))},G=(t,s)=>{if(s.key==="Enter")v(t,s.target.value);else return},W=C.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),w=[{key:"id",label:"ID"},{key:"resident_name",label:"Full Name"},{key:"name",label:"User Name"},{key:"email",label:"Email"},{key:"status",label:"Session Status"},{key:"account_status",label:"Account Status"},{key:"logged_in",label:"Last Logged In"},{key:"created_at",label:"Date Added"},{key:"actions",label:"Actions"}],y=Object.entries(l||{}).some(([t,s])=>["session_status","account_status"].includes(t)&&s&&s!=="");o.useEffect(()=>{y&&I(!0)},[y]);const[k,I]=o.useState(y),[X,Ve]=o.useState(!0),[$,Y]=o.useState(!1),[Z,M]=o.useState(S.data.reduce((t,s)=>(t[s.id]=!s.is_disabled,t),{})),q={id:t=>e.jsx("span",{className:"text-xs text-gray-500 font-medium",children:t.id}),resident_name:t=>{const s=t.resident??{},n=`${s.firstname??""} ${s.middlename??""} ${s.lastname??""} ${s.suffix??""}`.trim();return e.jsx("span",{className:"text-sm font-semibold text-gray-800",children:n||"—"})},name:t=>e.jsx("span",{className:"text-sm font-medium text-gray-800",children:t.username??"—"}),email:t=>e.jsx("span",{className:"text-xs text-gray-600",children:t.email??"—"}),status:t=>{var n;const s=t.status==="active";return e.jsx("span",{className:`
                    text-xs font-semibold px-3 py-1 rounded-full transition
                    ${s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}
                    hover:shadow-sm
                `,children:((n=t.status)==null?void 0:n.toUpperCase())??"—"})},logged_in:t=>{const s=t.updated_at?new Date(t.updated_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—";return e.jsx("span",{className:"text-xs text-gray-500",children:s})},account_status:t=>{const s=Z[t.id]??!0,n=a=>{M(d=>({...d,[t.id]:a})),R.patch(`/user/${t.id}/toggle-account`,{is_disabled:a?0:1}).then(d=>{d.data.success?c.success(d.data.message,{duration:3e3,closeButton:!0}):c.error(d.data.message||"Something went wrong.",{duration:3e3,closeButton:!0})}).catch(()=>{c.error("Failed to update account status.",{duration:3e3,closeButton:!0}),M(d=>({...d,[t.id]:!a}))})};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{checked:s,onCheckedChange:n,className:"bg-gray-200 hover:bg-gray-300"}),e.jsx("span",{className:`text-xs font-semibold ${s?"text-green-700":"text-red-700"}`,children:s?"ENABLED":"DISABLED"})]})},created_at:t=>{const s=t.created_at?new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"—";return e.jsx("span",{className:"text-xs text-gray-500",children:s})},actions:t=>e.jsx(ye,{actions:[{label:"Edit",icon:e.jsx(Le,{className:"w-4 h-4 text-blue-600"}),onClick:()=>le(t.id)},{label:"Delete",icon:e.jsx(Te,{className:"w-4 h-4 text-red-600"}),onClick:()=>ce(t.id)}]})},{data:r,setData:u,post:O,errors:ee,reset:te,clearErrors:se}=xe({resident_id:null,resident_name:"",resident_image:null,birthdate:"",purok_number:"",sex:"",username:"",email:"",password:"",password_confirmation:"",status:"active",is_disabled:!1,account_id:null,_method:void 0}),ae=Ee(C,u),re=w.map(t=>t.key),[x,ne]=o.useState(()=>{const t=localStorage.getItem("accounts_visible_columns");return t?JSON.parse(t):re});o.useEffect(()=>{localStorage.setItem("accounts_visible_columns",JSON.stringify(x))},[x]);const N=()=>{j(null),b(!1),K(null),P(null),te(),se()},oe=()=>{j("add"),b(!0)},ie=t=>{t.preventDefault(),O(route("user.store"),{onError:s=>{const n=Object.values(s).map((a,d)=>`<div key=${d}> ${a}</div>`);c.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:n.join("")}}),duration:4e3,closeButton:!0})}})},le=async t=>{try{const n=(await R.get(`${B}/user/${t}`)).data,a=n.resident;j("edit"),b(!0),u({resident_id:n.resident_id,resident_name:a?`${a.firstname} ${a.middlename} ${a.lastname} ${a.suffix??""}`.trim():"",resident_image:(a==null?void 0:a.image)||null,birthdate:(a==null?void 0:a.birthdate)||"",purok_number:(a==null?void 0:a.purok_number)||"",sex:(a==null?void 0:a.sex)||"",username:n.username,email:n.email,originalEmail:n.email,password:"",password_confirmation:"",account_id:n.id,_method:"PUT"})}catch(s){console.error("Error fetching account details:",s),c.error("Failed to fetch account details.")}},de=t=>{t.preventDefault(),r.account_id&&O(route("user.update",r.account_id),{onSuccess:()=>{c.success("User account updated successfully!",{description:"The changes have been saved.",duration:3e3,closeButton:!0}),N()},onError:s=>{const n=Object.values(s).map((a,d)=>`<div key=${d}>${a}</div>`);c.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:n.join("")}}),duration:4e3,closeButton:!0})}})},ce=t=>{V(t),f(!0)},me=()=>{F.delete(route("user.destroy",A)),f(!1)},ue=()=>{window.print()};return o.useEffect(()=>{h&&(N(),c.success(h,{description:"Operation successful!",duration:3e3,closeButton:!0})),m.success=null},[h]),o.useEffect(()=>{g&&c.error(g,{description:"Operation failed!",duration:3e3,closeButton:!0}),m.error=null},[g]),e.jsxs(ge,{children:[e.jsx(he,{title:"Resident Information"}),e.jsxs("div",{children:[e.jsx(ve,{richColors:!0}),e.jsx(je,{breadcrumbs:U}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(fe,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"User Accounts"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Manage and monitor"," ",e.jsx("span",{className:"font-medium",children:"user accounts"})," ","within the system. Use the tools below to"," ",e.jsx("span",{className:"font-medium",children:"create, update, filter, or export"})," ","information for administration and reports."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(_e,{allColumns:w,visibleColumns:x,setVisibleColumns:ne,onPrint:ue,showFilters:k,toggleShowFilters:()=>I(t=>!t)})}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:Q,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(be,{type:"text",placeholder:"Search Resident Name",value:D,onChange:t=>z(t.target.value),onKeyDown:t=>G("name",t.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(_,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Re,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(_,{className:"bg-blue-700 hover:bg-blue-400 ",type:"button",onClick:oe,children:e.jsx(Ue,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Account"})]})]})})]}),k&&e.jsx(Se,{queryParams:l,searchFieldName:v,visibleFilters:["session_status","account_status"],showFilters:!0,clearRouteName:"user.index",clearRouteParams:{}}),e.jsx(we,{passedData:S,allColumns:w,columnRenderers:q,queryParams:l,is_paginated:X,toggleShowAll:()=>Y(!$),showAll:$,visibleColumns:x})]})})}),e.jsxs(Ne,{isOpen:H,onClose:N,title:i==="add"?T?"Edit Account Details":"Add Account Details":"View Resident Details",children:[(i==="add"||i==="edit")&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:i==="add"?ie:de,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2",children:[i==="add"?"Create User Account – ":"Edit User Account – ",r.resident_name||"Select a Resident"]}),e.jsx("p",{className:"text-gray-600 text-sm",children:i==="add"?"Please select a resident and provide the account credentials (username, email, and password).":"Update the account credentials and status (password cannot be changed here)."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-50 p-4 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx($e,{htmlFor:"resident_image",value:"Profile Photo"}),e.jsx("img",{src:r.resident_image?`/storage/${r.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsxs("div",{children:[e.jsx(ke,{label:"Full Name",name:"resident_name",value:r.resident_name||"",placeholder:"Select a resident",onChange:ae,items:W,disabled:i==="edit"}),e.jsx(Ie,{message:ee.resident_id,className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx(p,{label:"Birthdate",name:"birthdate",value:r.birthdate||"",readOnly:!0}),e.jsx(p,{label:"Purok Number",name:"purok_number",value:r.purok_number||"",readOnly:!0}),e.jsx(p,{label:"Sex",name:"sex",value:r.sex||"",readOnly:!0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl shadow-sm space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Account Credentials"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx(p,{label:"Username",name:"username",value:r.username||"",onChange:t=>u("username",t.target.value)}),e.jsx(Oe,{data:r,setData:u,originalEmail:r.originalEmail??null})]}),i==="add"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx(p,{label:"Password",name:"password",type:"password",value:r.password||"",onChange:t=>u("password",t.target.value)}),e.jsx(p,{label:"Confirm Password",name:"password_confirmation",type:"password",value:r.password_confirmation||"",onChange:t=>u("password_confirmation",t.target.value)})]}),i==="add"&&e.jsx(Me,{data:r})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(_,{className:"bg-blue-700 hover:bg-blue-400 flex justify-end",type:"submit",disabled:i==="add"&&(!!J||!r.password||!r.password_confirmation),children:[i==="add"?"Create Account":"Update Account"," ",e.jsx(Be,{})]})})]})}),i==="view"&&E?e.jsx(Ae,{person:E}):null]}),e.jsx(De,{isOpen:L,onClose:()=>{f(!1)},onConfirm:me,residentId:A})]})]})}export{Bt as default};
