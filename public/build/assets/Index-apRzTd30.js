import{r as s,K as re,m as se,j as t,L as ae,S as T,a as oe}from"./app-C3NVK6am.js";import{u as le}from"./useAppUrl-DGjP6J_-.js";import{S as ne}from"./AdminLayout-C_zFBF4X.js";import ie from"./ActionMenu-Dw_7okjd.js";import{I as me}from"./InputField-C3AjjhVg.js";import{B as m}from"./button-DsDnJj0i.js";import{I as de}from"./input-CKFIdOeX.js";import ce from"./SidebarModal-Bh5Zqpgv.js";import{b as ue}from"./index-BWT_Fb6C.js";import{D as pe}from"./DropdownInputField-DmObZ_tC.js";import{t as n,T as xe}from"./index-DMUPqDLB.js";import he from"./DeleteConfirmationModal-Cgt7l8qY.js";import be from"./BreadcrumbsHeader-DXAgqkGq.js";import fe from"./FillterToggle-BpouJfMp.js";import ge from"./DynamicTableControls-BQIrmCIX.js";import je from"./DynamicTable-BS0N9oiI.js";import{I as A}from"./InputError-3iOBENfm.js";import{M as Se}from"./map-pin-Cfx1mZCE.js";import{S as _e}from"./search-DtodBBBc.js";import{L as ve}from"./list-plus-DDZNz4FJ.js";import{R as ye}from"./rotate-ccw-6LFpr02Z.js";import{S as Ne}from"./square-pen-4noa8V4d.js";import{T as ke}from"./trash-2-Dwe2m_QE.js";import"./sidebar-wPaUtDv3.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-D5UNyBOW.js";import"./index-DaXYrN_r.js";import"./floating-ui.react-dom-BPdg0msh.js";import"./x-DuWGoabV.js";import"./createLucideIcon-D2xZUByM.js";import"./tooltip-DmJvfED-.js";import"./nav-user-B_hmJ4S1.js";import"./avatar-BDstatoC.js";import"./dropdown-menu-DRKbjXak.js";import"./check-C13shK5h.js";import"./chevron-right-CYzJvvMM.js";import"./file-text-DgF7YVib.js";import"./users-round-D24lT0GM.js";import"./heart-pulse-B202c26o.js";import"./chevron-up-BK7V0l4s.js";import"./ellipsis-k3BFxFc-.js";import"./iconBase-DFRbZ-aH.js";import"./breadcrumb-c36xZWrz.js";import"./react-datepicker-eSr82AwM.js";import"./index-Cj-7ECFc.js";import"./constants-Cu2udUY3.js";function jt({streets:B,queryParams:a,puroks:N}){const F=[{label:"Barangay Resources",showOnMobile:!1},{label:"Street List",showOnMobile:!0}],L=le();a=a||{};const[R,d]=s.useState(!1),[V,c]=s.useState(""),[u,k]=s.useState(null),[w,U]=s.useState(a.name??""),[H,p]=s.useState(!1),[D,K]=s.useState(null),o=re().props,x=(o==null?void 0:o.success)??null,h=(o==null?void 0:o.error)??null,P=e=>{K(e),p(!0)},b=[{key:"id",label:"ID"},{key:"street_name",label:"Street Name"},{key:"purok_number",label:"Purok"},{key:"created_at",label:"Created At"},{key:"updated_at",label:"Updated At"},{key:"actions",label:"Actions"}],$=b.map(e=>e.key),[i,J]=s.useState(()=>{const e=localStorage.getItem("street_visible_columns");return e?JSON.parse(e):$});s.useEffect(()=>{localStorage.setItem("street_visible_columns",JSON.stringify(i))},[i]);const f=Object.entries(a||{}).some(([e,r])=>["purok"].includes(e)&&r&&r!=="");s.useEffect(()=>{f&&E(!0)},[f]);const[g,E]=s.useState(f),z=e=>{e.preventDefault(),j("name",w)},j=(e,r)=>{r&&r.trim()!==""?a[e]=r:delete a[e],a.page&&delete a.page,T.get(route("street.index",a))},Q=(e,r)=>{r.key==="Enter"&&j(e,r.target.value)},{data:S,setData:_,post:C,errors:I,reset:M,clearErrors:G}=se({street_name:"",purok_id:"",_method:void 0,street_id:null}),W={id:e=>e.id,street_name:e=>t.jsx("span",{className:"font-medium text-gray-900",children:e.street_name||"—"}),purok_number:e=>{var r;return t.jsx("span",{className:"text-sm text-gray-700",children:(r=e.purok)!=null&&r.purok_number?`Purok ${e.purok.purok_number}`:"—"})},created_at:e=>t.jsx("span",{className:"text-sm text-gray-500",children:e.created_at?new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),updated_at:e=>t.jsx("span",{className:"text-sm text-gray-500",children:e.updated_at?new Date(e.updated_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),actions:e=>t.jsx(ie,{actions:[{label:"Edit",icon:t.jsx(Ne,{className:"w-4 h-4 text-green-500"}),onClick:()=>X(e.id)},{label:"Delete",icon:t.jsx(ke,{className:"w-4 h-4 text-red-600"}),onClick:()=>P(e.id)}]})},X=async e=>{c("edit");try{const l=(await oe.get(`${L}/street/details/${e}`)).data.data;k(l),console.log(v);const y=v.find(te=>te.value===l.purok_id.toString());_({street_name:l.street_name||"",purok_id:(y==null?void 0:y.value)||"",_method:"PUT",street_id:l.id}),d(!0)}catch(r){console.error("Error fetching street details:",r),n.error("Failed to fetch street details.")}},Y=()=>{T.delete(route("street.destroy",D),{onError:e=>{console.error("Validation Errors:",e);const r=Object.values(e).join("<br />");n.error("Validation Error",{description:t.jsx("span",{dangerouslySetInnerHTML:{__html:r}}),duration:3e3,closeButton:!0})}}),p(!1)},Z=()=>{c("add"),d(!0)},q=e=>{e.preventDefault(),C(route("street.store"),{preserveScroll:!0,onError:r=>{console.error("Validation Errors:",r);const l=Object.values(r).join("<br />");n.error("Validation Error",{description:t.jsx("span",{dangerouslySetInnerHTML:{__html:l}}),duration:3e3,closeButton:!0})}})},ee=e=>{e.preventDefault(),C(route("street.update",S.street_id),{onError:r=>{console.error("Validation Errors:",r);const l=Object.values(r).join("<br />");n.error("Validation Error",{description:t.jsx("span",{dangerouslySetInnerHTML:{__html:l}}),duration:3e3,closeButton:!0})}})},O=()=>{d(!1),c(""),k(null),M(),G()},v=N.map(e=>({label:"Purok "+e.purok_number,value:e.id.toString()}));return s.useEffect(()=>{x&&(O(),n.success(x,{description:"Operation successful!",duration:3e3,closeButton:!0})),o.success=null},[x]),s.useEffect(()=>{h&&n.error(h,{description:"Operation failed!",duration:3e3,closeButton:!0}),o.error=null},[h]),t.jsxs(ne,{children:[t.jsx(ae,{title:"Barangay Infrastructure"}),t.jsx(be,{breadcrumbs:F}),t.jsx(xe,{richColors:!0}),t.jsxs("div",{className:"pt-4 mb-10",children:[t.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:t.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[t.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:t.jsx(Se,{className:"w-6 h-6 text-green-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Street Directory"}),t.jsx("p",{className:"text-sm text-gray-500",children:"View, add, and manage all streets and zones in the barangay."})]})]})}),t.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[t.jsxs("div",{className:"flex flex-wrap justify-between gap-2 mb-4",children:[t.jsx(ge,{allColumns:b,visibleColumns:i,setVisibleColumns:J,showFilters:g,toggleShowFilters:()=>E(e=>!e)}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("form",{onSubmit:z,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[t.jsx(de,{type:"text",placeholder:"Search Street name",value:w,onChange:e=>U(e.target.value),onKeyDown:e=>Q("name",e),className:"ml-4"}),t.jsx(m,{type:"submit",className:"border border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",variant:"outline",children:t.jsx(_e,{})})]}),t.jsxs(m,{variant:"outline",onClick:()=>Z(),className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",children:[t.jsx(ve,{className:"w-4 h-4"}),"Add Street"]})]})]}),g&&t.jsx(fe,{queryParams:a,searchFieldName:j,visibleFilters:["purok"],clearRouteName:"street.index",clearRouteParams:{},puroks:N,showFilters:g}),t.jsx(je,{queryParams:a,passedData:B,allColumns:b,columnRenderers:W,visibleColumns:i,showTotal:!0})]})]})}),t.jsx(ce,{isOpen:R,onClose:O,title:V==="add"?"Add Street":"Edit Street",children:t.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:u?ee:q,children:[t.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Street Information"}),t.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Please enter the street information below."}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(me,{label:"Street Name",name:"street_name",value:S.street_name||"",onChange:e=>_("street_name",e.target.value),placeholder:"Enter Street Name"}),t.jsx(A,{message:I.street_name,className:"mt-1"}),t.jsx(pe,{label:"Purok",name:"purok_id",value:S.purok_id||"",onChange:e=>_("purok_id",e.target.value),placeholder:"Select Purok",items:v}),t.jsx(A,{message:I.purok_id,className:"mt-1"})]}),t.jsxs("div",{className:"flex justify-between items-center p-3 mt-6",children:[u===null?t.jsxs(m,{type:"button",onClick:()=>M(),className:"flex items-center gap-1",children:[t.jsx(ye,{})," Reset"]}):t.jsx("div",{}),t.jsxs(m,{className:"bg-blue-700 hover:bg-blue-500",type:"submit",children:[u?"Update":"Add"," ",t.jsx(ue,{})]})]})]})}),t.jsx(he,{isOpen:H,onClose:()=>p(!1),onConfirm:Y,residentId:D})]})]})}export{jt as default};
