import{r as s,K as re,m as oe,j as e,L as ne,S as A,a as ce}from"./app-DYAKcHNl.js";import me from"./DynamicTable-Bf7mtaHD.js";import{u as de}from"./useAppUrl-DkyKnUCU.js";import{S as ue,H as pe}from"./AdminLayout-Bi-pGIXA.js";import xe from"./ActionMenu-BHPpl9Ng.js";import ye from"./DynamicTableControls-CrDmP0BC.js";import{I as fe}from"./input-CxeHRvhM.js";import{B as f}from"./button-jar7PpFE.js";import ge from"./FillterToggle-CdqcdYDe.js";import be from"./SidebarModal-DoEksQTx.js";import{I as M}from"./InputField-BTVJ7rGE.js";import{I as g}from"./InputError-BCroSFvG.js";import{D as he}from"./DropdownInputField-C_3Z0_m2.js";import{I as je,a as ve,b as Ne}from"./index-CWXZl8V5.js";import _e from"./DeleteConfirmationModal-Bpm1W1P1.js";import{t as o,T as we}from"./index-BXPBQSyU.js";import{I as Se}from"./InputLabel-B79Xyb5l.js";import Fe from"./BreadcrumbsHeader-CKnM-akv.js";import{S as Ce}from"./search-BOXoXOu7.js";import{L as Ee}from"./list-plus-AGHRHozz.js";import{R as De}from"./rotate-ccw-BEemZo6t.js";import{S as Oe}from"./square-pen-CvXrJSEC.js";import{T as Ie}from"./trash-2-B7mfE7cR.js";import"./createLucideIcon-DQ0uzrfc.js";import"./sidebar-D72yRY0x.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-B15nK32a.js";import"./index-BURBo1Fb.js";import"./floating-ui.react-dom-DyVQx6GH.js";import"./x-BsD2Ph8w.js";import"./tooltip-cMZakSlP.js";import"./nav-user-3DjZb-iD.js";import"./avatar-BZEWERC7.js";import"./dropdown-menu-ChwWV6C9.js";import"./check-D4vnSq3V.js";import"./chevron-right-C9Drcg-G.js";import"./file-text-DJosvJjd.js";import"./users-round-DYx1XjIx.js";import"./heart-pulse-Cq-MPyvz.js";import"./chevron-up-vstyJ82G.js";import"./ellipsis-D8qtlaGc.js";import"./react-datepicker-DIEhyEna.js";import"./index-D98XC42S.js";import"./constants-CqzG63r4.js";import"./iconBase-sZqcdp0w.js";import"./breadcrumb-BhM0RIEr.js";const St=({facilities:L,names:R,types:B,queryParams:l})=>{const U=[{label:"Barangay Resources",showOnMobile:!1},{label:"Facilities",showOnMobile:!0}],$=de();l=l||{};const[V,b]=s.useState(!1),[H,h]=s.useState(""),[n,F]=s.useState(null),[C,z]=s.useState(l.name??""),[Q,j]=s.useState(!1),[E,K]=s.useState(null),r=re().props,v=(r==null?void 0:r.success)??null,N=(r==null?void 0:r.error)??null,_=[{key:"id",label:"ID"},{key:"image",label:"Image"},{key:"name",label:"Name"},{key:"facility_type",label:"Facilitiy Type"},{key:"quantity",label:"Quantity"},{key:"created_at",label:"Created At"},{key:"updated_at",label:"Updated At"},{key:"actions",label:"Actions"}],J=_.map(t=>t.key),[u,q]=s.useState(()=>{const t=localStorage.getItem("facilities_visible_columns");return t?JSON.parse(t):J});s.useEffect(()=>{localStorage.setItem("facilities_visible_columns",JSON.stringify(u))},[u]);const w=Object.entries(l||{}).some(([t,a])=>["faci_name","faci_type"].includes(t)&&a&&a!=="");s.useEffect(()=>{w&&O(!0)},[w]);const[D,O]=s.useState(w),G=t=>{t.preventDefault(),S("name",C)},S=(t,a)=>{a&&a.trim()!==""?l[t]=a:delete l[t],l.page&&delete l.page,A.get(route("barangay_facility.index",l))},P=(t,a)=>{a.key==="Enter"&&S(t,a.target.value)},W={id:t=>t.id,image:t=>e.jsx("img",{src:t.facility_image?`/storage/${t.facility_image}`:"/images/default-avatar.jpg",onError:a=>{a.target.onerror=null,a.target.src="/images/default-avatar.jpg"},alt:"Resident",className:"w-16 h-16 min-w-16 min-h-16 object-cover rounded-sm border"}),name:t=>e.jsx("span",{className:"font-medium text-gray-900",children:t.name||"—"}),facility_type:t=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:t.facility_type||"—"}),quantity:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.quantity??"—"}),created_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.created_at?new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),updated_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.updated_at?new Date(t.updated_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),actions:t=>e.jsx(xe,{actions:[{label:"Edit",icon:e.jsx(Oe,{className:"w-4 h-4 text-green-500"}),onClick:()=>ae(t.id)},{label:"Delete",icon:e.jsx(Ie,{className:"w-4 h-4 text-red-600"}),onClick:()=>se(t.id)}]})},X=()=>{h("add"),b(!0)},{data:c,setData:p,post:I,errors:x,reset:k,clearErrors:Y}=oe({facilities:[[]],_method:void 0,facility_id:null}),Z=()=>{p("facilities",[...c.facilities||[],{}])},ee=t=>{const a=[...c.facilities||[]];a.splice(t,1),p("facilities",a),o.warning("Facility removed.",{duration:2e3})},T=()=>{b(!1),h(""),F(null),k(),Y()},y=(t,a,i)=>{p(m=>{const d=[...m.facilities];return i==="facility_image"&&t instanceof File?d[a]={...d[a],facility_image:t,previewImage:URL.createObjectURL(t)}:d[a]={...d[a],[i]:t},{...m,facilities:d}})},te=t=>{t.preventDefault(),I(route("barangay_facility.store"),{onError:a=>{console.error("Validation Errors:",a);const i=Object.values(a).join("<br />");o.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:i}}),duration:3e3,closeButton:!0})}})},ae=async t=>{h("edit");try{const i=(await ce.get(`${$}/barangay_facility/details/${t}`)).data.facility;p({facilities:[{facility_image:null,previewImage:i.facility_image?`/storage/${i.facility_image}`:null,name:i.name||"",facility_type:i.facility_type||"",quantity:i.quantity||1}],_method:"PUT",facility_id:i.id}),F(i),b(!0)}catch(a){console.error("Error fetching facility details:",a)}},ie=t=>{t.preventDefault(),I(route("barangay_facility.update",c.facility_id),{onError:a=>{console.error("Validation Errors:",a);const i=Object.values(a).join("<br />");o.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:i}}),duration:3e3,closeButton:!0})}})},se=t=>{K(t),j(!0)},le=()=>{A.delete(route("barangay_facility.destroy",E),{onError:t=>{console.error("Validation Errors:",t);const a=Object.values(t).join("<br />");o.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}}),j(!1)};return s.useEffect(()=>{v&&(T(),o.success(v,{description:"Operation successful!",duration:3e3,closeButton:!0})),r.success=null},[v]),s.useEffect(()=>{N&&o.error(N,{description:"Operation failed!",duration:3e3,closeButton:!0}),r.error=null},[N]),e.jsxs(ue,{children:[e.jsx(ne,{title:"Barangay Infrastructure"}),e.jsx(Fe,{breadcrumbs:U}),e.jsx(we,{richColors:!0}),e.jsxs("div",{className:"pt-4 mb-10",children:[e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(pe,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Barangay Facilities Overview"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Review, filter, and manage all barangay facilities including health centers, schools, public spaces, and other essential services. Monitor their types, availability, and details efficiently to ensure proper community management."})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(ye,{allColumns:_,visibleColumns:u,setVisibleColumns:q,showFilters:D,toggleShowFilters:()=>O(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:G,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(fe,{type:"text",placeholder:"Search facility name",value:C,onChange:t=>z(t.target.value),onKeyDown:t=>P("name",t.target.value),className:"ml-4"}),e.jsx(f,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Ce,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(f,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:X,children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add a Facility"})]})]})]}),D&&e.jsx(ge,{queryParams:l,searchFieldName:S,visibleFilters:["faci_name","faci_type"],showFilters:!0,types:B,names:R,clearRouteName:"barangay_facility.index",clearRouteParams:{}}),e.jsx(me,{queryParams:l,passedData:L,allColumns:_,columnRenderers:W,visibleColumns:u,showTotal:!0})]})]})}),e.jsx(be,{isOpen:V,onClose:()=>{T()},title:H=="add"?"Add Facility":"Edit Facility",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:n?ie:te,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Facility Information"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about the existing facilities in the barangay."}),Array.isArray(c.facilities)&&c.facilities.map((t,a)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(Se,{htmlFor:`facility_image_${a}`,value:"Facility Photo"}),e.jsx("img",{src:t.previewImage||"/images/default-avatar.jpg",alt:"Facility Image",className:"w-32 h-32 object-cover rounded-sm border border-gray-200"}),e.jsx("input",{id:`facility_image_${a}`,type:"file",accept:"image/*",onChange:i=>{const m=i.target.files[0];m&&y(m,a,"facility_image")},className:`block w-full text-sm text-gray-500
                                                                                            file:mr-2 file:py-1 file:px-3
                                                                                            file:rounded file:border-0
                                                                                            file:text-xs file:font-semibold
                                                                                            file:bg-blue-50 file:text-blue-700
                                                                                            hover:file:bg-blue-100`}),e.jsx(g,{message:x[`facilities.${a}.facility_image`],className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsx(M,{label:"Facility Name",type:"text",name:"name",value:t.name||"",onChange:i=>y(i.target.value,a,"name"),placeholder:"Enter Facility Name"}),e.jsx(g,{message:x[`facilities.${a}.name`],className:"mt-1"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(he,{label:"Facility Type",name:"facility_type",value:t.facility_type||"",onChange:i=>y(i.target.value,a,"facility_type"),items:[{label:"Government",value:"government"},{label:"Protection",value:"protection"},{label:"Security",value:"security"},{label:"Finance",value:"finance"},{label:"Service",value:"service"},{label:"Commerce",value:"commerce"}],placeholder:"Select Facility Type"}),e.jsx(g,{message:x[`facilities.${a}.facility_type`],className:"mt-1"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(M,{type:"number",label:"Quantity",name:"quantity",value:t.quantity||"",onChange:i=>y(i.target.value,a,"quantity"),placeholder:"Enter Quantity"}),e.jsx(g,{message:x[`facilities.${a}.quantity`],className:"mt-1"})]})]})]})]}),n===null&&e.jsx("button",{type:"button",onClick:()=>ee(a),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(je,{className:"text-2xl"})})]},a)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[n===null?e.jsxs("button",{type:"button",onClick:Z,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(ve,{className:"text-2xl"}),e.jsx("span",{children:"Add Facility"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[n==null&&e.jsxs(f,{type:"button",onClick:()=>k(),children:[e.jsx(De,{})," Reset"]}),e.jsxs(f,{className:"bg-blue-700 hover:bg-blue-400 ",type:"submit",children:[n?"Update":"Add"," ",e.jsx(Ne,{})]})]})]})]})}),e.jsx(_e,{isOpen:Q,onClose:()=>{j(!1)},onConfirm:le,residentId:E})]})]})};export{St as default};
