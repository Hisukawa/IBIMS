import{K as U,r as d,j as e,L as F,S as P,a as _}from"./app-CxQIk-Ug.js";import{C as R,a as M}from"./card-BG0NPpDo.js";import{B as y}from"./button-eWlrO1vI.js";import{B as $}from"./badge-DzBr3EbV.js";import{S as z}from"./AdminLayout-Ch0RJaaH.js";import q from"./DeleteConfirmationModal-BIRqOANr.js";import G from"./BreadcrumbsHeader-ztKk4f-G.js";import{t as l,T as V}from"./index-BxD4ZtM3.js";import{A as X,B as H,J as K,R as J}from"./constants-DEVjsWMH.js";import{P as W}from"./pencil-C-3x6pFB.js";import{T as Y}from"./trash-2-BAENtbzN.js";import{F as Q}from"./file-output-DqEtO73h.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./sidebar-CmbCP2Gp.js";import"./input-C3invO0g.js";import"./index-a0Ptbf1R.js";import"./index-D20yT8t5.js";import"./floating-ui.react-dom-CDryE2et.js";import"./x-CoOb-UyO.js";import"./createLucideIcon-DUzL0oSb.js";import"./skeleton-DNA1kKC7.js";import"./tooltip-DJWjtVs0.js";import"./nav-user-CUeqll6F.js";import"./avatar-CT_f4ETp.js";import"./dropdown-menu-BIG2J05K.js";import"./check-BlEJph0r.js";import"./chevron-right-9pm6d_Wd.js";import"./useAppUrl-CjqOY4Q6.js";import"./users-round-Dhttk4ok.js";import"./heart-pulse-DEWB0aq-.js";import"./chevron-up-DDsNXP0q.js";import"./breadcrumb-ZXvPNnk5.js";function ke({blotter_details:t}){var b,S,w;const B=[{label:"Katarungang Pambarangay",showOnMobile:!1},{label:"Summons",href:route("summon.index"),showOnMobile:!1},{label:"View Summon",showOnMobile:!0}],a=U().props,x=(a==null?void 0:a.success)??null,u=(a==null?void 0:a.error)??null,[D,p]=d.useState(!1),[N,C]=d.useState(null),O=r=>{P.get(route("summon.elevate",r))},E=r=>{C(r),p(!0)},k=()=>{console.log("Deleting",N),p(!1)},c=r=>r?new Date(r).toLocaleDateString("en-US",{dateStyle:"medium"}):"-",A=r=>{if(!r)return"-";const s=new Date(r),n=s.toLocaleDateString("en-US",{dateStyle:"medium"}),f=s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0});return e.jsxs("div",{children:[e.jsx("div",{children:n}),e.jsxs("div",{className:"text-sm text-gray-500",children:["around ",f]})]})},h=(r,s)=>(r==null?void 0:r.filter(n=>n.role_type===s))||[],g=(r,s)=>r!=null&&r.length?e.jsx("ul",{className:"space-y-2",children:r.map(n=>e.jsxs("li",{className:"border p-3 rounded-lg bg-gray-50 flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-800",children:n.display_name}),n.resident&&e.jsxs("span",{className:"text-sm text-gray-600",children:[J[n.resident.gender],","," ",n.resident.contact_number||"No contact"]}),n.notes&&e.jsxs("span",{className:"text-xs text-gray-500 italic",children:["Notes: ",n.notes]})]},n.id))}):e.jsxs("p",{className:"text-sm text-gray-500",children:["No ",s,"s recorded."]}),o=(r,s)=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600",children:r}),e.jsx("p",{className:"text-sm text-gray-900",children:s||"Not provided"})]}),m=(r,s)=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 border-b pb-1 mb-2",children:r}),e.jsx("p",{className:"whitespace-pre-line text-sm leading-relaxed text-gray-700",children:(s==null?void 0:s.trim())||"No details provided."})]}),v=r=>{const s={resolved:"bg-green-100 text-green-700",pending:"bg-yellow-100 text-yellow-700",elevated:"bg-red-100 text-red-700"};return e.jsx($,{className:`capitalize px-2 py-1 rounded ${s[r]||"bg-gray-200 text-gray-700"}`,children:r||"Unknown"})},I=async()=>{var r;try{const s=await _.get(route("summon.generateForm",t.id),{responseType:"blob"}),n=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),f=window.URL.createObjectURL(n),i=document.createElement("a");i.href=f;const j=s.headers["content-disposition"],T=j==null?void 0:j.match(/filename="?([^"]+)"?/),L=T?T[1]:"summon_form.docx";i.setAttribute("download",L),document.body.appendChild(i),i.click(),i.remove(),l.success("Summon form generated successfully!",{duration:3e3,className:"bg-green-100 text-green-800"})}catch(s){console.error("Summon form generation failed:",s);let n="An unexpected error occurred. Please try again.";s.response?(r=s.response.data)!=null&&r.message?n=s.response.data.message:s.response.status===404?n="The requested summon form could not be found.":s.response.status===500?n="A server error occurred while generating the summon form.":n=`Server responded with status ${s.response.status}.`:s.request?n="No response from server. Please check your internet connection.":n=`Request failed: ${s.message}`,l.error("Failed to generate summon form",{description:n,duration:6e3,className:"bg-red-100 text-red-800",closeButton:!0})}};return d.useEffect(()=>{x&&l.success(x,{description:"Operation successful!",duration:3e3,closeButton:!0}),a.success=null},[x]),d.useEffect(()=>{u&&l.error(u,{description:"Operation failed!",duration:3e3,closeButton:!0}),a.error=null},[u]),e.jsxs(z,{children:[e.jsx(F,{title:"View Blotter Report"}),e.jsx(V,{richColors:!0}),e.jsx(G,{breadcrumbs:B}),e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs(R,{className:"shadow-sm border rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Report: ",t.type_of_incident]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Filed on"," ",c(t.created_at)," at"," ",t.location||"Unknown location"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{size:"sm",variant:"outline",onClick:()=>O(t.id),children:[e.jsx(W,{className:"w-4 h-4 mr-1"})," Edit"]}),e.jsxs(y,{size:"sm",variant:"destructive",onClick:()=>E(t.id),children:[e.jsx(Y,{className:"w-4 h-4 mr-1"})," Delete"]}),e.jsxs(y,{size:"sm",className:"bg-green-500 hover:bg-green-600 text-white",onClick:I,children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"Summon Form"]})]})]}),e.jsxs(M,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[o("Type of Incident",t.type_of_incident),o("Incident Date",A(t.incident_date)),o("Location",t.location),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600",children:"Report Status"}),v(X[t.report_status])]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[o("Recorded By",(b=t.recorded_by)!=null&&b.resident?`${t.recorded_by.resident.firstname} ${t.recorded_by.resident.middlename||""} ${t.recorded_by.resident.lastname}`:null),o("Official Position",H[(S=t.recorded_by)==null?void 0:S.position])]}),m("Narrative",t.narrative_details),m("Actions Taken",t.actions_taken),m("Resolution",t.resolution),m("Recommendations",t.recommendations),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-xs text-gray-500",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Created At:"})," ",c(t.created_at)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Last Updated:"})," ",c(t.updated_at)]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Participants"}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-1",children:"Complainants"}),g(h(t.participants,"complainant"),"complainant")]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-1",children:"Respondents"}),g(h(t.participants,"respondent"),"respondent")]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-1",children:"Witnesses"}),g(h(t.participants,"witness"),"witness")]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Summons"}),(w=t.summons)!=null&&w.length?t.summons.map(r=>e.jsxs(R,{className:"p-4 bg-white border border-gray-200 shadow-sm rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Status:"}),v(K[r.status])]}),e.jsxs("div",{className:"text-sm text-gray-800 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Issued By:"})," ",r.issued_by||"Unknown"]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-700",children:"Hearing Sessions"}),e.jsx("ul",{className:"space-y-2 mt-2",children:r.takes.map(s=>e.jsxs("li",{className:"border rounded p-2 bg-gray-50",children:[e.jsxs("p",{className:"text-sm text-gray-800",children:[e.jsxs("span",{className:"font-medium",children:["Session"," ",s.session_number,":"]})," ",c(s.hearing_date)]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Status:"," ",s.session_status]}),s.session_remarks&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:s.session_remarks})]},s.id))})]})]},r.id)):e.jsx("p",{className:"text-sm text-gray-500",children:"No summons issued."})]})]})]}),e.jsx(q,{isOpen:D,onClose:()=>p(!1),onConfirm:k,residentId:N})]})]})}export{ke as default};
