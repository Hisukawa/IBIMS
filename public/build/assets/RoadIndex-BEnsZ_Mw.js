import{r,K as ne,m as ie,j as e,L as de,S as M,a as me}from"./app-BDFxb8TA.js";import ce from"./DynamicTable-CHhkyrvT.js";import ue from"./DynamicTableControls-Be3FEhX9.js";import{B as h}from"./button-CpOsaw8_.js";import{I as pe}from"./input-jJkVEZh6.js";import{u as ge}from"./useAppUrl-8JzvxBJd.js";import xe from"./ActionMenu-B1t3zEf2.js";import be from"./FillterToggle-D90xyrDX.js";import{e as he}from"./constants-a7o6YRsm.js";import{D as B}from"./DropdownInputField-iTn69Qsd.js";import{I as m}from"./InputError-DeIudV3g.js";import{I as F}from"./InputField-oCrZeJoU.js";import{S as fe}from"./SelectField-DYDkNw60.js";import{I as ye,a as je,b as ve}from"./index-C-4CIZA0.js";import _e from"./SidebarModal-BzXA3oBB.js";import{t as g,T as Ne}from"./index-BV4yT7DH.js";import we from"./DeleteConfirmationModal-BmD4yp-x.js";import{I as Se}from"./InputLabel-DqkNamG1.js";import{S as Re,H as Ce}from"./AdminLayout-CM3_VNfS.js";import Ee from"./BreadcrumbsHeader-BjgQDL1u.js";import{S as De}from"./search-DYm-wMZU.js";import{L as ke}from"./list-plus-DpSArsmV.js";import{R as Oe}from"./rotate-ccw-Bv3g-5u1.js";import{S as Ae}from"./square-pen-vvSpg7l-.js";import{T as Te}from"./trash-2-D0zHUyfY.js";import"./createLucideIcon-tGOSRdoQ.js";import"./dropdown-menu-enabQI5J.js";import"./index-XCqKAzY-.js";import"./index-DkI8As0p.js";import"./floating-ui.react-dom-CH_KqBmZ.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./check-BVd6L0zb.js";import"./chevron-right-CYSwUaqK.js";import"./tooltip-w_xHr43J.js";import"./ellipsis-fOBkrL-4.js";import"./react-datepicker-bgVyIYaD.js";import"./index-Cxc8uHiV.js";import"./chevron-up-D85Lw7mi.js";import"./stringFormat-Dx_XIxG1.js";import"./iconBase-D4DM0745.js";import"./x-BwVgvZTi.js";import"./sidebar-DTvw3aXB.js";import"./nav-user-BI5LsarM.js";import"./avatar-uAJ5rm9d.js";import"./file-text-F4iMt6p7.js";import"./users-round-CP9XJTu1.js";import"./heart-pulse-DPuDzfZz.js";import"./breadcrumb-DUDN2ulf.js";const Dt=({roads:$,types:I,maintains:L,queryParams:o})=>{const U=[{label:"Barangay Resources",showOnMobile:!1},{label:"Roads",showOnMobile:!0}],z=ge();o=o||{};const[V,f]=r.useState(!1),[H,y]=r.useState(""),[n,C]=r.useState(null),[E,K]=r.useState(o.name??""),[G,j]=r.useState(!1),[D,J]=r.useState(null),l=ne().props,v=(l==null?void 0:l.success)??null,_=(l==null?void 0:l.error)??null,N=[{key:"id",label:"ID"},{key:"image",label:"Road Image"},{key:"road_type",label:"Road Type"},{key:"maintained_by",label:"Maintained By"},{key:"length",label:"Length"},{key:"status",label:"Status"},{key:"condition",label:"Condition"},{key:"created_at",label:"Created At"},{key:"updated_at",label:"Updated At"},{key:"actions",label:"Actions"}],P=N.map(t=>t.key),[x,Q]=r.useState(()=>{const t=localStorage.getItem("roads_visible_columns");return t?JSON.parse(t):P}),w=Object.entries(o).some(([t,a])=>["road_type","maintained_by","road_status","road_condition"].includes(t)&&a&&a!==""),[S,k]=r.useState(w);r.useEffect(()=>{w&&k(!0)},[w]),r.useEffect(()=>{localStorage.setItem("roads_visible_columns",JSON.stringify(x))},[x]);const X=t=>{t.preventDefault(),R("name",E)},R=(t,a)=>{a&&a.trim()!==""?o[t]=a:delete o[t],o.page&&delete o.page,M.get(route("barangay_road.index",o))},Y=(t,a)=>{a.key==="Enter"&&R(t,a.target.value)},W={id:t=>t.id,image:t=>e.jsx("img",{src:t.road_image?`/storage/${t.road_image}`:"/images/default-avatar.jpg",onError:a=>{a.target.onerror=null,a.target.src="/images/default-avatar.jpg"},alt:"Resident",className:"w-16 h-16 min-w-16 min-h-16 object-cover rounded-sm border"}),road_type:t=>e.jsx("span",{className:"font-medium text-gray-900",children:he[t.road_type]||"—"}),maintained_by:t=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:t.maintained_by||"—"}),length:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.length!=null?`${t.length} Km`:"—"}),condition:t=>{const a={good:"bg-green-100 text-green-800",fair:"bg-yellow-100 text-yellow-800",poor:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium capitalize ${a[t.condition]||"bg-gray-100 text-gray-600"}`,children:t.condition||"—"})},status:t=>{const a={active:"bg-blue-100 text-blue-800",under_maintenance:"bg-orange-100 text-orange-800",closed:"bg-gray-200 text-gray-700"};return e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium capitalize ${a[t.status]||"bg-gray-100 text-gray-600"}`,children:t.status||"—"})},created_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.created_at?new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),updated_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.updated_at?new Date(t.updated_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),actions:t=>e.jsx(xe,{actions:[{label:"Edit",icon:e.jsx(Ae,{className:"w-4 h-4 text-green-500"}),onClick:()=>se(t.id)},{label:"Delete",icon:e.jsx(Te,{className:"w-4 h-4 text-red-600"}),onClick:()=>oe(t.id)}]})},Z=()=>{y("add"),f(!0)},{data:c,setData:b,post:O,errors:i,reset:A,clearErrors:q}=ie({roads:[[]],_method:void 0,road_id:null}),ee=()=>{b("roads",[...c.roads||[],{}])},te=t=>{const a=[...c.roads||[]];a.splice(t,1),b("roads",a),g.warning("Road removed.",{duration:2e3})},T=()=>{f(!1),y(""),C(null),A(),q()},d=(t,a,s)=>{b(u=>{const p=[...u.roads];return s==="road_image"&&t instanceof File?p[a]={...p[a],road_image:t,previewImage:URL.createObjectURL(t)}:p[a]={...p[a],[s]:t},{...u,roads:p}})},ae=t=>{t.preventDefault(),O(route("barangay_road.store"),{onError:a=>{const s=Object.values(a).join("<br />");g.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})}})},se=async t=>{y("edit");try{const s=(await me.get(`${z}/barangay_road/details/${t}`)).data.road;C(s),b({roads:[{road_image:null,previewImage:s.road_image?`/storage/${s.road_image}`:null,road_type:s.road_type||"",length:s.length||"",condition:s.condition||"",status:s.status||"",maintained_by:s.maintained_by||""}],_method:"PUT",road_id:s.id}),f(!0)}catch(a){console.error("Error fetching road details:",a)}},re=t=>{t.preventDefault(),O(route("barangay_road.update",n.id),{_method:"PUT",roads:c.roads,onError:a=>{console.error("Validation Errors:",a)}})},oe=t=>{J(t),j(!0)},le=()=>{M.delete(route("barangay_road.destroy",D),{onError:t=>{console.error("Validation Errors:",t);const a=Object.values(t).join("<br />");g.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})}}),j(!1)};return r.useEffect(()=>{v&&(T(),g.success(v,{description:"Operation successful!",duration:3e3,closeButton:!0})),l.success=null},[v]),r.useEffect(()=>{_&&g.error(_,{description:"Operation failed!",duration:3e3,closeButton:!0}),l.error=null},[_]),e.jsxs(Re,{children:[e.jsx(de,{title:"Barangay Roads"}),e.jsx(Ee,{breadcrumbs:U}),e.jsx(Ne,{richColors:!0}),e.jsx("div",{className:"pt-4 mb-10",children:e.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[e.jsx("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-full",children:e.jsx(Ce,{className:"w-6 h-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Barangay Roads Overview"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Review, filter, and manage existing barangay roads efficiently. Keep track of road types, conditions, and maintenance details."})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(ue,{allColumns:N,visibleColumns:x,setVisibleColumns:Q,showFilters:S,toggleShowFilters:()=>k(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:X,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(pe,{type:"text",placeholder:"Search road lengths",value:E,onChange:t=>K(t.target.value),onKeyDown:t=>Y("name",t.target.value),className:"ml-4"}),e.jsx(h,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(De,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(h,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:Z,children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add a Road"})]})]})]}),S&&e.jsx(be,{queryParams:o,searchFieldName:R,visibleFilters:["road_type","maintained_by","road_status","road_condition"],types:I,names:L,clearRouteName:"barangay_road.index",clearRouteParams:{},showFilters:S}),e.jsx(ce,{queryParams:o,passedData:$,allColumns:N,columnRenderers:W,visibleColumns:x,showTotal:!0})]})}),e.jsx(_e,{isOpen:V,onClose:()=>{T()},title:H=="add"?"Add Road":"Edit Road",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:n?re:ae,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Roads"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about roads within the barangay."}),Array.isArray(c.roads)&&c.roads.map((t,a)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(Se,{htmlFor:`facility_image_${a}`,value:"Road Image"}),e.jsx("img",{src:t.previewImage||"/images/default-avatar.jpg",alt:"Road Image",className:"w-32 h-32 object-cover rounded-sm border border-gray-200"}),e.jsx("input",{id:`facility_image_${a}`,type:"file",accept:"image/*",onChange:s=>{const u=s.target.files[0];u&&d(u,a,"road_image")},className:`block w-full text-sm text-gray-500
                                                                                                                                    file:mr-2 file:py-1 file:px-3
                                                                                                                                    file:rounded file:border-0
                                                                                                                                    file:text-xs file:font-semibold
                                                                                                                                    file:bg-blue-50 file:text-blue-700
                                                                                                                                    hover:file:bg-blue-100`}),e.jsx(m,{message:i[`roads.${a}.road_image`],className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(B,{label:"Road Type",name:"road_type",value:t.road_type||"",onChange:s=>d(s.target.value,a,"road_type"),placeholder:"Select road type",items:[{label:"Asphalt",value:"asphalt"},{label:"Concrete",value:"concrete"},{label:"Gravel",value:"gravel"},{label:"Natural Earth Surface",value:"natural_earth_surface"}]}),e.jsx(m,{message:i[`roads.${a}.road_type`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(F,{label:"Length (km)",name:"length",type:"number",step:"0.01",value:t.length||"",onChange:s=>d(s.target.value,a,"length"),placeholder:"e.g. 2.50"}),e.jsx(m,{message:i[`roads.${a}.length`],className:"mt-1"})]})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(B,{label:"Condition",name:"condition",value:t.condition||"",onChange:s=>d(s.target.value,a,"condition"),placeholder:"Select condition",items:[{label:"Good",value:"good"},{label:"Fair",value:"fair"},{label:"Poor",value:"poor"},{label:"Under Construction",value:"under_construction"},{label:"Impassable",value:"impassable"}]}),e.jsx(m,{message:i[`roads.${a}.condition`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(fe,{label:"Status",name:"status",value:t.status||"",onChange:s=>d(s.target.value,a,"status"),items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}]}),e.jsx(m,{message:i[`roads.${a}.status`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsx(F,{label:"Maintained By",name:"maintained_by",value:t.maintained_by||"",onChange:s=>d(s.target.value,a,"maintained_by"),placeholder:"e.g. Barangay Government"}),e.jsx(m,{message:i[`roads.${a}.maintained_by`],className:"mt-1"})]})]}),n===null&&e.jsx("button",{type:"button",onClick:()=>te(a),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(ye,{className:"text-2xl"})})]},a)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[n===null?e.jsxs("button",{type:"button",onClick:ee,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(je,{className:"text-2xl"}),e.jsx("span",{children:"Add Road"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[n==null&&e.jsxs(h,{type:"button",onClick:()=>A(),children:[e.jsx(Oe,{})," Reset"]}),e.jsxs(h,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[n?"Update":"Add"," ",e.jsx(ve,{})]})]})]})]})})," ",e.jsx(we,{isOpen:G,onClose:()=>{j(!1)},onConfirm:le,residentId:D})]})})]})};export{Dt as default};
