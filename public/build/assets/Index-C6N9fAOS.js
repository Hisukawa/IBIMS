import{K as H,r as o,j as e,L as Y,$ as Q,S as h,a as X}from"./app-3hJRSR-U.js";import{S as J,P}from"./AdminLayout-CMkRaBto.js";import{B as k}from"./button-DUtl5Jjy.js";import{I as W}from"./input-DC1SVip5.js";import Z from"./BreadcrumbsHeader-CA4P7iEZ.js";import{t as g,T as q}from"./index-BN_piO4R.js";import ee from"./DynamicTable-DEqvTr_u.js";import te from"./ActionMenu-DA5mCRDS.js";import{R as se,b as re}from"./constants-Byjz8ljZ.js";import oe from"./SidebarModal-0crBg26A.js";import le from"./DynamicTableControls-zlltVskD.js";import ae from"./FillterToggle-Wduwfwy9.js";import{u as ie}from"./useAppUrl-Do5e-2xe.js";import ne from"./PersonDetailContent-DngKTqFL.js";import ce from"./DeleteConfirmationModal-CDmQshp3.js";import{E as me}from"./ExportButton-CzFNe6mS.js";import{S as de}from"./search-BhHXccmb.js";import{L as pe}from"./list-plus-CF26_OOz.js";import{E as xe}from"./eye-BXGV6yLH.js";import{S as ue}from"./square-pen-C_qxyj3E.js";import{T as fe}from"./trash-2-BhdTiZZQ.js";import"./sidebar-djYsJkPW.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-BCWJfSDL.js";import"./index-CtJNCL1o.js";import"./floating-ui.react-dom-Dohp26gR.js";import"./x-BBeGo-fM.js";import"./createLucideIcon-Dn3cR7Zy.js";import"./tooltip-BhuOt-yH.js";import"./nav-user-6pBx6Ts6.js";import"./avatar-C02IyeLk.js";import"./dropdown-menu-xqUv-ifZ.js";import"./check-DoeJPBhS.js";import"./chevron-right-BA6XigVc.js";import"./stringFormat-Dx_XIxG1.js";import"./file-text-BEqJih8D.js";import"./users-round-DTwYczQW.js";import"./heart-pulse-BrJ3-jMX.js";import"./chevron-up-BA8rZG-c.js";import"./breadcrumb-BT2Ednb2.js";import"./ellipsis-DYfBYJEG.js";import"./react-datepicker-K2FZ8Flc.js";import"./index-DiBLEkOC.js";import"./iconBase-C66PvLGm.js";import"./index-2rbIgCyb.js";import"./index-Dhzcrh1s.js";import"./file-output-DB7CO1VO.js";function mt({allergies:C,puroks:_,queryParams:r}){const R=[{label:"Medical Information",showOnMobile:!1},{label:"Allergies",showOnMobile:!0}];r=r||{};const M=ie(),l=H().props,c=(l==null?void 0:l.success)??null,m=(l==null?void 0:l.error)??null,[T,d]=o.useState(!1),[b,O]=o.useState(null),[j,A]=o.useState(r.name??""),[I,p]=o.useState(!1),[y,w]=o.useState(null),F=t=>{if(!t)return"Unknown";const s=new Date(t),a=new Date;let n=a.getFullYear()-s.getFullYear();const i=a.getMonth()-s.getMonth();return(i<0||i===0&&a.getDate()<s.getDate())&&n--,n},L=t=>{t.preventDefault(),x("name",j)},x=(t,s)=>{s&&s.trim()!==""?r[t]=s:delete r[t],r.page&&delete r.page,h.get(route("allergy.index",r))},B=(t,s)=>{if(s.key==="Enter")x(t,s.target.value);else return},u=[{key:"no",label:"No."},{key:"name",label:"Resident Name"},{key:"age",label:"Age"},{key:"sex",label:"Sex"},{key:"allergy_name",label:"Allergy Name"},{key:"reaction_description",label:"Description"},{key:"purok_number",label:"Purok Number"},{key:"actions",label:"Actions"}],[N,U]=o.useState(u.map(t=>t.key)),f=Object.entries(r||{}).some(([t,s])=>["purok","sex","age_group","allergy"].includes(t)&&s&&s!=="");o.useEffect(()=>{f&&S(!0)},[f]);const[v,S]=o.useState(f),z={no:t=>t.number??"-",name:t=>{const s=t.resident??{};return e.jsxs("span",{children:[s.firstname," ",s.middlename??""," ",s.lastname," ",s.suffix??""]})},age:t=>{var a;const s=F((a=t.resident)==null?void 0:a.birthdate);return typeof s!="number"?"Unknown":e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsx("span",{className:"font-medium text-gray-800",children:s}),s>60&&e.jsx("span",{className:"text-xs text-rose-500 font-semibold",children:"Senior Citizen"})]})},sex:t=>{var i,D,E;const s=(i=t.resident)==null?void 0:i.sex,a=((D=se)==null?void 0:D[s])??s??"Unknown",n=((E=re)==null?void 0:E[s])??"bg-gray-100 text-gray-800 px-2 py-1 rounded";return e.jsx("span",{className:`py-1 px-2 rounded-xl text-sm font-medium whitespace-nowrap ${n}`,children:a})},allergy_name:t=>t.allergy_name??"—",reaction_description:t=>e.jsx("span",{className:"line-clamp-2 text-sm text-gray-700",children:t.reaction_description||"—"}),purok_number:t=>{var s;return((s=t.resident)==null?void 0:s.purok_number)??"—"},actions:t=>e.jsx(te,{actions:[{label:"View",icon:e.jsx(xe,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>{var s;return G((s=t.resident)==null?void 0:s.id)}},{label:"Edit",icon:e.jsx(ue,{className:"w-4 h-4 text-green-500"}),onClick:()=>{h.get(route("allergies.edit",t.id))}},{label:"Delete",icon:e.jsx(fe,{className:"w-4 h-4 text-red-600"}),onClick:()=>$(t.id)}]})},V=()=>{p(!1),w(null)},$=t=>{O(t),d(!0)},K=()=>{h.delete(route("allergy.destroy",b),{onError:t=>{console.error("Validation Errors:",t);const s=Object.values(t).join("<br />");g.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})}}),d(!1)},G=async t=>{try{const s=await X.get(`${M}/resident/showresident/${t}`);w(s.data.resident)}catch(s){console.error("Error fetching placeholders:",s)}p(!0)};return o.useEffect(()=>{c&&(V(),g.success(c,{description:"Operation successful!",duration:3e3,closeButton:!0})),l.success=null},[c]),o.useEffect(()=>{m&&g.error(m,{description:"Operation failed!",duration:3e3,closeButton:!0}),l.error=null},[m]),e.jsxs(J,{children:[e.jsx(Y,{title:"Medical Information"}),e.jsxs("div",{children:[e.jsx(q,{richColors:!0}),e.jsx(Z,{breadcrumbs:R}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-full",children:e.jsx(P,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Allergy Records"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Manage and track resident allergy information to ensure safety and proper medical assistance. Use the tools below to"," ",e.jsx("span",{className:"font-medium",children:"search, filter, and export"})," ","records for healthcare monitoring and programs."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx(le,{allColumns:u,visibleColumns:N,setVisibleColumns:U,showFilters:v,toggleShowFilters:()=>S(t=>!t)}),e.jsx(me,{url:"report/export-allergy-pdf",queryParams:r,label:"Export Allergy Records as PDF",type:"pdf"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:L,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(W,{type:"text",placeholder:"Search Disability or Resident Name",value:j,onChange:t=>A(t.target.value),onKeyDown:t=>B("name",t.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(k,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(de,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsx("div",{className:"relative group z-50",children:e.jsxs(Q,{href:route("medical.create"),children:[e.jsx(k,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",type:"button",children:e.jsx(pe,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Medical Information"})]})})]})})]}),v&&e.jsx(ae,{queryParams:r,searchFieldName:x,visibleFilters:["purok","sex","age_group","allergy"],puroks:_,showFilters:!0,clearRouteName:"allergy.index",clearRouteParams:{}}),e.jsx(ee,{passedData:C,allColumns:u,columnRenderers:z,queryParams:r,visibleColumns:N,showTotal:!0})]})})}),e.jsx(oe,{isOpen:I,onClose:()=>p(!1),title:"Resident Details",children:y&&e.jsx(ne,{person:y})}),e.jsx(ce,{isOpen:T,onClose:()=>{d(!1)},onConfirm:K,residentId:b})]})]})}export{mt as default};
