import{r,K as ue,m as pe,j as e,S as ge,a as U}from"./app-DluTzGHb.js";import xe from"./DynamicTable-DoGyDRNI.js";import{u as be}from"./useAppUrl-D9cToTnc.js";import{S as V}from"./skeleton-BJ7hj38Q.js";import{u as je}from"./useQuery-BsR9h68q.js";import he from"./ActionMenu-Csrc1Y8-.js";import fe from"./DynamicTableControls-BEolPDSu.js";import{I as ye}from"./input-CC5TkSWh.js";import{B as y}from"./button-Dh7fzRxe.js";import{F as ve}from"./FillterToggle-DBEPxxLr.js";import{P as _e,c as Ne}from"./constants-DMcup6PS.js";import Se from"./SidebarModal-D5hk8Ket.js";import{I as g}from"./InputField-BerIYkkS.js";import{I as i}from"./InputError-DzLekI5E.js";import{D as I}from"./DropdownInputField-hnq8INbi.js";import{T as Ce}from"./textarea-BpO5tX1E.js";import{S as we}from"./SelectField-JY5Znhdw.js";import{I as Ee,a as Pe,b as Te}from"./index-BubsEo3K.js";import{t as x,T as ke}from"./index-0PVT8G0g.js";import De from"./DeleteConfirmationModal-BzlNGbtB.js";import{I as Fe}from"./InputLabel-CoBDfTl_.js";import{S as Oe}from"./search-9FvAwn6S.js";import{L as Ae}from"./list-plus-M7Ccg2X5.js";import{R as $e}from"./rotate-ccw-CLa1nXwW.js";import{E as Le}from"./eye-BV2fkW8i.js";import{S as Re}from"./square-pen-DT4IBfsq.js";import{T as Me}from"./trash-2-NHn4tTt5.js";import"./createLucideIcon-Ax5zlIWT.js";import"./dropdown-menu-BXZ3MBVH.js";import"./index-BRJrdTSG.js";import"./index-CYvM7WXr.js";import"./floating-ui.react-dom-B6VSRzGx.js";import"./check-ZTEKtxjY.js";import"./chevron-right-C0HBejuY.js";import"./tooltip-CysDY4zj.js";import"./ellipsis-DazvAe9f.js";import"./clsx-B-dksMZM.js";import"./chevron-up-DZw0GgUV.js";import"./x-CrNk9GF0.js";import"./iconBase-BuSDbsmV.js";const Ct=()=>{const T=be(),[q,v]=r.useState(!1),[H,_]=r.useState(""),[d,k]=r.useState(null),b=ue().props,N=(b==null?void 0:b.error)??null,[m,D]=r.useState({}),[F,O]=r.useState(m.name??""),[K,S]=r.useState(!1),[A,$]=r.useState(null),{data:c,isLoading:J,isError:z,error:G,refetch:C}=je({queryKey:["projects",m],queryFn:async()=>{const{data:t}=await U.get(`${T}/barangay_project`,{params:m});return t},keepPreviousData:!0,staleTime:1e3*60*5}),Q=c==null?void 0:c.projects,X=c==null?void 0:c.institutions,W=c==null?void 0:c.categories,w=[{key:"id",label:"ID"},{key:"title",label:"Title"},{key:"image",label:"Project Image"},{key:"description",label:"Description"},{key:"status",label:"Status"},{key:"category",label:"Category"},{key:"responsible_institution",label:"Responsible Institution"},{key:"budget",label:"Budget"},{key:"funding_source",label:"Funding Source"},{key:"start_date",label:"Start Date"},{key:"end_date",label:"End Date"},{key:"actions",label:"Actions"}],Y=w.map(t=>t.key),[j,Z]=r.useState(()=>{const t=localStorage.getItem("projects_visible_columns");return t?JSON.parse(t):Y}),E=Object.entries(m||{}).some(([t,s])=>["project_status","project_category","responsible_inti","start_date","end_date"].includes(t)&&s&&s!==""),[L,R]=r.useState(E);r.useEffect(()=>{E&&R(!0)},[E]),r.useEffect(()=>{localStorage.setItem("projects_visible_columns",JSON.stringify(j))},[j]);const ee=t=>{t.preventDefault(),P("name",F)},P=(t,s)=>{D(a=>{const n={...a};return s&&s.trim()!==""&&s!=="All"?n[t]=s:delete n[t],delete n.page,n})},te=(t,s)=>{s.key==="Enter"&&P(t,s.target.value)},se={id:t=>e.jsx("span",{className:"text-gray-600 text-sm",children:t.id}),image:t=>e.jsx("img",{src:t.project_image?`/storage/${t.project_image}`:"/images/default-avatar.jpg",onError:s=>{s.target.onerror=null,s.target.src="/images/default-avatar.jpg"},alt:"Resident",className:"w-16 h-16 min-w-16 min-h-16 object-cover rounded-sm border"}),title:t=>e.jsx("span",{className:"font-semibold text-gray-900",children:t.title||"—"}),description:t=>e.jsx("span",{className:"text-gray-700 text-sm",children:t.description?t.description.length>50?t.description.substring(0,50)+"...":t.description:"—"}),status:t=>{var a;const s=(a=t.status)==null?void 0:a.toLowerCase();return e.jsx("span",{className:Ne[s]||"bg-gray-100 px-2 py-1 rounded-lg text-gray-800 text-xs",children:_e[s]||t.status||"—"})},category:t=>e.jsx("span",{className:"text-gray-800 text-sm",children:t.category||"—"}),responsible_institution:t=>e.jsx("span",{className:"text-gray-700",children:t.responsible_institution||"—"}),budget:t=>e.jsx("span",{className:"font-medium text-indigo-700",children:t.budget?`₱${parseFloat(t.budget).toLocaleString()}`:"—"}),funding_source:t=>e.jsx("span",{className:"text-gray-600",children:t.funding_source||"—"}),start_date:t=>e.jsx("span",{className:"text-gray-500 text-sm",children:t.start_date||"—"}),end_date:t=>e.jsx("span",{className:"text-gray-500 text-sm",children:t.end_date||"—"}),actions:t=>e.jsx(he,{actions:[{label:"View",icon:e.jsx(Le,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>handleView(t.id)},{label:"Edit",icon:e.jsx(Re,{className:"w-4 h-4 text-green-500"}),onClick:()=>ie(t.id)},{label:"Delete",icon:e.jsx(Me,{className:"w-4 h-4 text-red-600"}),onClick:()=>de(t.id)}]})},ae=()=>{_("add"),v(!0)},{data:u,setData:h,post:M,errors:o,reset:B,clearErrors:re}=pe({projects:[[]],_method:void 0,project_id:null}),oe=()=>{h("projects",[...u.projects||[],{}])},le=t=>{const s=[...u.projects||[]];s.splice(t,1),h("projects",s),x.warning("Project removed.",{duration:2e3})},f=()=>{v(!1),_(""),k(null),$(null),B(),re()},l=(t,s,a)=>{h(n=>{const p=[...n.projects];return a==="project_image"&&t instanceof File?p[s]={...p[s],project_image:t,previewImage:URL.createObjectURL(t)}:p[s]={...p[s],[a]:t},{...n,projects:p}})},ne=t=>{t.preventDefault(),M(route("barangay_project.store"),{onError:s=>{console.error("Validation Errors:",s);const a=Object.values(s).join("<br />");x.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})},onSuccess:()=>{C(),f()}})},ie=async t=>{_("edit");try{const a=(await U.get(`${T}/barangay_project/details/${t}`)).data.project;console.log(a),k(a),h({projects:[{title:a.title||"",description:a.description||"",project_image:null,previewImage:a.project_image?`/storage/${a.project_image}`:null,status:a.status||"planning",category:a.category||"",responsible_institution:a.responsible_institution||"",budget:a.budget||0,funding_source:a.funding_source||"",start_date:a.start_date||"",end_date:a.end_date||""}],_method:"PUT",project_id:a.id}),v(!0)}catch(s){console.error("Error fetching project details:",s)}},ce=t=>{t.preventDefault(),M(route("barangay_project.update",u.project_id),{onError:s=>{console.error("Validation Errors:",s);const a=Object.values(s).join("<br />");x.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})},onSuccess:()=>{C(),f()}})},de=t=>{$(t),S(!0)},me=()=>{ge.delete(route("barangay_project.destroy",A),{onError:t=>{console.error("Validation Errors:",t);const s=Object.values(t).join("<br />");x.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})},onSuccess:()=>{C(),f()}}),S(!1)};return r.useEffect(()=>{N&&x.error(N,{description:"Operation failed!",duration:3e3,closeButton:!0}),b.error=null},[N]),J?e.jsxs("div",{className:"gap-2 space-y-4",children:[e.jsx(V,{className:"h-[20px] w-[100px] rounded-full"}),e.jsx(V,{className:"h-[10px] w-[100px] rounded-full"})]}):z?e.jsxs("div",{className:"text-red-500",children:["Error: ",G.message]}):e.jsxs("div",{className:"p-2 md:px-2 md:py-2",children:[e.jsx(ke,{richColors:!0}),e.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(fe,{allColumns:w,visibleColumns:j,setVisibleColumns:Z,showFilters:L,toggleShowFilters:()=>R(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:ee,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(ye,{type:"text",placeholder:"Search title or description ",value:F,onChange:t=>O(t.target.value),onKeyDown:t=>te("name",t.target.value),className:"ml-4"}),e.jsx(y,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Oe,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(y,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:ae,children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add a Project"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[L&&e.jsx(ve,{queryParams:m,searchFieldName:P,visibleFilters:["project_status","project_category","responsible_inti","start_date","end_date"],showFilters:!0,categories:W,institutions:X,setQueryParams:D,setQuery:O,clearRouteAxios:!0}),e.jsx(xe,{passedData:Q,allColumns:w,columnRenderers:se,visibleColumns:j,showTotal:!0})]})]}),e.jsx(Se,{isOpen:q,onClose:()=>{f()},title:H=="add"?"Add Project":"Edit Project",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:d?ce:ne,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Development Projects"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about barangay projects, their status, funding, and responsible institutions."}),Array.isArray(u.projects)&&u.projects.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(Fe,{htmlFor:`facility_image_${s}`,value:"Facility Photo"}),e.jsx("img",{src:t.previewImage||"/images/default-avatar.jpg",alt:"Project Image",className:"w-32 h-32 object-cover rounded-sm border border-gray-200"}),e.jsx("input",{id:`facility_image_${s}`,type:"file",accept:"image/*",onChange:a=>{const n=a.target.files[0];n&&l(n,s,"project_image")},className:`block w-full text-sm text-gray-500
                                                                                                                                file:mr-2 file:py-1 file:px-3
                                                                                                                                file:rounded file:border-0
                                                                                                                                file:text-xs file:font-semibold
                                                                                                                                file:bg-blue-50 file:text-blue-700
                                                                                                                                hover:file:bg-blue-100`}),e.jsx(i,{message:o[`projects.${s}.project_image`],className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(g,{label:"Project Title",name:"title",value:t.title||"",onChange:a=>l(a.target.value,s,"title"),placeholder:"e.g. Barangay Health Center Construction"}),e.jsx(i,{message:o[`projects.${s}.title`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(I,{label:"Category",name:"category",value:t.category||"",onChange:a=>l(a.target.value,s,"category"),placeholder:"Select category",items:[{label:"Infrastructure",value:"infrastructure"},{label:"Health",value:"health"},{label:"Education",value:"education"},{label:"Livelihood",value:"livelihood"},{label:"Others",value:"others"}]}),e.jsx(i,{message:o[`projects.${s}.category`],className:"mt-1"})]})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsx(Ce,{label:"Description",name:"description",value:t.description||"",onChange:a=>l(a.target.value,s,"description"),className:"text-gray-600",placeholder:"Brief description of the project..."}),e.jsx(i,{message:o[`projects.${s}.description`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(we,{label:"Status",name:"status",value:t.status||"",onChange:a=>l(a.target.value,s,"status"),items:[{label:"Planning",value:"planning"},{label:"Ongoing",value:"ongoing"},{label:"Completed",value:"completed"},{label:"Cancelled",value:"cancelled"}]}),e.jsx(i,{message:o[`projects.${s}.status`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(I,{label:"Responsible Institution",name:"responsible_institution",value:t.responsible_institution||"",onChange:a=>l(a.target.value,s,"responsible_institution"),placeholder:"Enter institution"}),e.jsx(i,{message:o[`projects.${s}.responsible_institution`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(g,{type:"number",step:"0.01",label:"Budget (₱)",name:"budget",value:t.budget||"",onChange:a=>l(a.target.value,s,"budget"),placeholder:"e.g. 500000"}),e.jsx(i,{message:o[`projects.${s}.budget`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx(g,{label:"Funding Source",name:"funding_source",value:t.funding_source||"",onChange:a=>l(a.target.value,s,"funding_source"),placeholder:"e.g. LGU, NGO, National Government"}),e.jsx(i,{message:o[`projects.${s}.funding_source`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(g,{type:"date",label:"Start Date",name:"start_date",value:t.start_date||"",onChange:a=>l(a.target.value,s,"start_date")}),e.jsx(i,{message:o[`projects.${s}.start_date`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(g,{type:"date",label:"End Date",name:"end_date",value:t.end_date||"",onChange:a=>l(a.target.value,s,"end_date")}),e.jsx(i,{message:o[`projects.${s}.end_date`],className:"mt-1"})]})]}),d===null&&e.jsx("button",{type:"button",onClick:()=>le(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(Ee,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[d===null?e.jsxs("button",{type:"button",onClick:oe,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Pe,{className:"text-2xl"}),e.jsx("span",{children:"Add Project"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[d==null&&e.jsxs(y,{type:"button",onClick:()=>B(),children:[e.jsx($e,{})," Reset"]}),e.jsxs(y,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[d?"Update":"Add"," ",e.jsx(Te,{})]})]})]})]})}),e.jsx(De,{isOpen:K,onClose:()=>{S(!1)},onConfirm:me,residentId:A})]})};export{Ct as default};
